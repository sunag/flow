/**
 * https://github.com/sunag/flow
 */
function __flow__addCSS(t){try{const e=document.createElement("style");e.setAttribute("type","text/css"),e.innerHTML=t,document.head.appendChild(e)}catch(t){}}__flow__addCSS("f-element .ti { vertical-align: middle; font-size: 17px; display: inline-block; margin-right: 5px;}f-element f-disconnect .ti { font-size: 20px; margin-top: -8px; margin-left: -12px;}@keyframes f-animation-open { 0% { transform: scale(.5); opacity: 0; } 100% { transform: scale(1); opacity: 1; }}f-canvas,f-canvas canvas.background,f-canvas canvas.frontground { position: absolute; top: 0; left: 0; margin: 0; padding: 0; width: 100%; height: 100%; -webkit-touch-callout: none; transition: opacity .17s;}f-canvas { cursor: grab;}f-canvas canvas.frontground { z-index: 10;}body.dragging *:not(.drag) { pointer-events: none !important;}f-canvas.grabbing * { cursor: grabbing; user-select: none;}f-canvas canvas.background,f-canvas canvas.frontground { position: fixed; overflow: hidden;}f-canvas canvas.frontground { pointer-events: none;}::-webkit-scrollbar { width: 6px; height: 6px;}::-webkit-scrollbar-thumb:hover{ background: #014fc5;}::-webkit-scrollbar-track { background: #363636;}::-webkit-scrollbar-thumb { background-color: #666666; border-radius: 8px; border: 0;}f-canvas f-content { left: 0; top: 0;}f-canvas f-content,f-canvas f-area { position: absolute; display: block;}f-canvas canvas.map { position: absolute; top: 10px; right: 10px; z-index: 50; backdrop-filter: blur( 10px ); background-color: rgba( 45, 45, 48, .8 );}f-node { position: absolute; margin: 0; padding: 0; user-select: none; width: 320px; z-index: 1; cursor: auto; filter: drop-shadow(0 0 10px #00000061); backdrop-filter: blur(4px);}f-node.selected { z-index: 2;}f-canvas.focusing canvas.background,f-canvas.focusing f-node:not(.selected),f-canvas.focusing f-element f-disconnect:not(.selected) { opacity: 0; pointer-events: none;}.dragging f-canvas f-element f-disconnect { opacity: 0;}.dragging.node f-canvas.focusing canvas.background,.dragging.node f-canvas.focusing f-node:not(.selected) { opacity: .5;}f-node.selected,f-canvas.dragging-rio f-node:hover,f-canvas.dragging-lio f-node:hover { filter: drop-shadow(0 0 10px #00000061) drop-shadow(0 0 8px #4444dd);}f-node.closed f-element:not(:first-child) { display: none;}f-node.center { top: 50%; left: 50%; transform: translate( -50%, -50% );}f-node.top-right { top: 0; right: 0;}f-node.top-center { top: 0; left: 50%; transform: translateX( -50% );}f-node.top-left { top: 0; left: 0;}f-node { transition: filter 0.2s ease, opacity 0.12s ease;}f-node { animation: .2s f-animation-open 1 alternate ease-out;}f-tips,f-drop,f-menu,f-menu input,f-menu button,f-element,f-element input,f-element select,f-element button,f-element textarea { font-family: 'Open Sans', sans-serif; font-size: 12px; text-transform: initial; line-height: normal; color: #eeeeee; outline: solid 0px #000; margin: 0; padding: 0; border: 0; user-select: none; -webkit-tap-highlight-color: transparent; transition: background 0.2s ease, filter 0.2s ease;}f-node.resizable { display: grid; width: auto !important;}f-node.resizable f-element:last-child { resize: both; overflow: auto; min-width: 100px;}f-element input:read-only { color: #666;}f-element input,f-element textarea { text-transform: initial;}f-element input { transition: background 0.1s ease;}f-element input,f-element select,f-element button,f-element textarea { background-color: #232324d1;}f-element { position: relative; width: calc( 100% - 14px ); background: rgba(45, 45, 48, 0.95); pointer-events: auto; border-bottom: 2px solid #232323; display: flex; padding-left: 7px; padding-right: 7px; padding-top: 2px; padding-bottom: 2px;}f-element:after,f-element:before { transition: opacity .17s; opacity: 0; content: '';}f-element[tooltip]:hover:after,f-element[tooltip]:focus-within:after { font-size: 14px !important; display: flex; justify-content: center; position: fixed; margin-left: -7px; width: calc( 100% ); background: #1d1d1de8; border: 1px solid #444444a1; border-radius: 6px; color: #dadada; content: attr( tooltip ); margin-top: -41px; font-size: 16px; padding-top: 3px; padding-bottom: 3px; z-index: 10; opacity: 1; backdrop-filter: blur(4px); white-space: nowrap; overflow: hidden; text-shadow: 1px 1px 0px #0007;}f-element[tooltip]:hover:before,f-element[tooltip]:focus-within:before { border: solid; border-color: #1d1d1de8 transparent; border-width: 12px 6px 0 6px; left: calc( 50% - 6px ); bottom: 30px; position: absolute; opacity: 1; z-index: 11;}f-element[error] { background-color: #ff0000;}f-element[error]:hover:after,f-element[error]:focus-within:after { border: none; background-color: #ff0000bb; filter: drop-shadow( 2px 2px 5px #000 ); color: #fff;}f-element[error]:hover:before,f-element[error]:focus-within:before { border-color: #ff0000bb transparent;}f-element { height: 24px;}f-element input { margin-top: 2px; margin-bottom: 2px; box-shadow: inset 0px 1px 1px rgb(0 0 0 / 20%), 0px 1px 0px rgb(255 255 255 / 5%); margin-left: 2px; margin-right: 2px; width: 100%; padding-left: 4px; padding-right: 4px; line-height: 100%;}f-element f-string:has( i[type=icon] ) input { padding-right: 23px;}f-element input.number { cursor: col-resize;}f-element input:focus[type='text'], f-element input:focus[type='range'], f-element input:focus[type='color'] { background: rgba( 0, 0, 0, 0.6 ); outline: solid 1px rgba( 0, 80, 200, 0.98 );}f-element input[type='color'] { appearance: none; padding: 0; margin-left: 2px; margin-right: 2px; height: calc( 100% - 4px ); margin-top: 2px; border: none;}f-element input[type='color']::-webkit-color-swatch-wrapper { padding: 2px;}f-element input[type='color']::-webkit-color-swatch { border: none; cursor: alias;}f-element input[type='range'] { appearance: none; width: 100%; overflow: hidden; padding: 0; cursor: ew-resize;}f-element input[type='range']::-webkit-slider-runnable-track { appearance: none; height: 10px; color: #13bba4; margin: 0;}f-element input[type='range']::-webkit-slider-thumb { appearance: none; width: 0; background: #434343; box-shadow: -500px 0 0 500px rgba( 0, 120, 255, 0.98 ); border-radius: 50%; border: 0 !important;}f-element input[type='range']::-webkit-slider-runnable-track { margin-left: -4px; margin-right: -5px;}f-element input[type='checkbox'] { appearance: none; cursor: pointer;}f-element input[type='checkbox'].toggle { height: 20px; width: 45px; border-radius: 16px; display: inline-block; position: relative; margin: 0; margin-top: 2px; background: linear-gradient( 0deg, #292929 0%, #0a0a0ac2 100% ); transition: all 0.2s ease;}f-element input[type='checkbox'].toggle:after { content: \"\"; position: absolute; top: 2px; left: 2px; width: 16px; height: 16px; border-radius: 50%; background: white; box-shadow: 0 1px 2px rgba(44, 44, 44, 0.2); transition: all 0.2s cubic-bezier(0.5, 0.1, 0.75, 1.35);}f-element input[type='checkbox'].toggle:checked { background: linear-gradient( 0deg, #0177fb 0%, #0177fb 100% );}f-element input[type='checkbox'].toggle:checked:after { transform: translatex(25px);}f-element.auto-height { display: table;}f-element textarea { width: calc( 100% - 18px ); padding-top: 1px; padding-bottom: 3px; padding-left: 4px; padding-right: 8px; margin-top: 2px; margin-left: 2px; height: calc( 100% - 8px ); max-height: 300px; border-radius: 2px; resize: none; box-shadow: inset 0px 1px 1px rgb(0 0 0 / 20%), 0px 1px 0px rgb(255 255 255 / 5%);}f-element.auto-height textarea { resize: auto;}f-element select { width: 100%; margin-top: 2px; margin-bottom: 2px; margin-left: 2px; margin-right: 2px; cursor: pointer; box-shadow: inset 0px 1px 1px rgb(0 0 0 / 20%), 0px 1px 0px rgb(255 255 255 / 5%);}f-element f-toolbar { position: absolute; top: 0; height: 100%; align-content: space-around; margin-top: auto; margin-bottom: auto; margin-left: 6px; margin-right: 6px; font-size: 18px; line-height: 18px; display: inline-flex; justify-content: flex-end; left: 2px;}f-element f-toolbar button { opacity: .7; cursor: pointer; font-size: 14px; width: unset; height: unset; border-radius: unset; border: unset; outline: 0; background-color: unset; box-shadow: unset; padding-right: 0; padding-left: 0; margin-left: 0; margin-right: 0;}f-element f-toolbar button span { padding-right: 5px;}f-element f-toolbar button:hover,f-element f-toolbar button:active { opacity: 1; border: 0; background-color: unset;}f-element input.range-value { width: 60px; text-align: center;}f-menu.context button,f-element button { width: 100%; height: calc( 100% - 4px ); margin-left: 2px; margin-right: 2px; margin-top: 3px; border-radius: 3px; cursor: pointer;}f-element button { box-shadow: inset 1px 1px 1px 0 rgb(255 255 255 / 17%), inset -2px -2px 2px 0 rgb(0 0 0 / 26%);}f-element button:hover { color: #fff; background-color: #2a2a2a;}f-element button:active { border: 1px solid rgba( 0, 120, 255, 0.98 );}f-element f-inputs,f-element f-subinputs { display: flex; justify-content: flex-end; width: 100%;}f-element f-inputs { left: 100px; top: 50%; transform: translateY( -50% ); position: absolute; width: calc( 100% - 106px ); height: calc( 100% - 4px );}f-element.inputs-disable f-inputs { filter: grayscale(100%); opacity: .5;}f-element.inputs-disable f-inputs input { pointer-events: none;}f-element f-label,f-element span { margin: auto; text-shadow: 1px 1px 0px #0007;}f-element f-label { padding-left: 4px; white-space: nowrap; position: absolute; top: 50%; transform: translateY( -50% ); width: calc( 100% - 20px );}f-element.right f-label { text-align: right;}f-element.center f-label { text-align: center;}f-element f-label i { font-size: 18px; margin-right: 4px; vertical-align: sub; margin-right: 0;}f-element f-label.center { width: 100%; text-align: center; display: block;}f-element.title { background-color: #3a3a3ab0; background-color: #3b3b43ed; cursor: all-scroll; border-top-left-radius: 6px; border-top-right-radius: 6px;}f-element:last-child { border-bottom-left-radius: 6px; border-bottom-right-radius: 6px;}f-element.blue { background-color: #014fc5;}f-element.red { background-color: #bd0b0b;}f-element.green { background-color: #148d05;}f-element.yellow { background-color: #d6b100;}f-element.title.left { text-align: left; display: inline-grid; justify-content: start;}f-element.title f-title { text-align: center; font-size: 15px; position: absolute; top: 50%; transform: translateY( -50% ); width: calc( 100% - 14px );}f-element.title > i { font-size: 21px; position: absolute; right: 8px; top: 50%; transform: translateY( -50% ); opacity: .7;}f-element.title f-toolbar i { font-size: 22px; display: contents; right: unset; left: unset;}f-element.title.left span { text-align: left;}f-element f-io { border: 2px solid #dadada; width: 7px; height: 7px; position: absolute; background: #242427; border-radius: 8px; float: left; left: -7px; top: calc( 50% - 5px ); cursor: alias; box-shadow: 0 0 3px 2px #0000005e; z-index: 1;}f-element f-io.connect,f-canvas.dragging-rio f-element:hover f-io.lio,f-canvas.dragging-lio f-element:hover f-io.rio { zoom: 1.4;}f-node.io-connect f-io:not(.connect) { border: 2px solid #dadada !important; zoom: 1 !important;}f-element f-io.rio { float: right; right: -7px; left: unset;}f-element f-disconnect { position: absolute; left: -22px; top: 50%; transform: translateY(-50%); font-size: 22px; filter: drop-shadow(0 0 5px #000); text-shadow: 0px 0px 5px black; cursor: pointer; transition: opacity .2s;}f-element.input-right f-disconnect { right: -35px; left: unset;}f-element f-disconnect:hover { color: #ff3300;}f-element textarea::-webkit-scrollbar { width: 6px;}f-element textarea::-webkit-scrollbar-track { background: #111; } f-element textarea::-webkit-scrollbar-thumb { background: #0177fb; }f-element textarea::-webkit-scrollbar-thumb:hover { background: #1187ff; }f-element.small { height: 18px;}f-element.large { height: 36px;}f-canvas.dragging-lio f-node:not(.io-connect) f-element.rio:hover,f-canvas.dragging-rio f-node:not(.io-connect) f-element.lio:hover,f-element.select { background-color: rgba(61, 70, 82, 0.98);}f-element.invalid > f-io { zoom: 1 !important;}f-element.invalid::after,.zoom f-element.no-zoom::after { font-size: 14px !important; display: flex; justify-content: center; align-items:center; margin: auto; position: absolute; width: 100%; height: 100%; background: #bd0b0b77; vertical-align: middle; color: #fff; content: 'Incompatible!'; opacity: .95; backdrop-filter: grayscale(100%); white-space: nowrap; overflow: hidden; left: 0; top: 0; text-transform: initial;}.zoom f-element.no-zoom::after { background: #0b3fbd77; content: 'Incompatible with zoom!';}f-treeview { width: 100%; background-color: #232324d1; border-radius: 2px; overflow-y: auto; overflow-x: hidden; margin-top: 2px; margin-left: 2px; height: calc( 100% - 6px ); box-shadow: inset 0px 1px 1px rgb(0 0 0 / 20%), 0px 1px 0px rgb(255 255 255 / 5%);}f-treeview f-treeview-node { position: relative; margin-top: 1px; min-height: 24px;}f-treeview f-treeview-node f-treeview-children { position: relative; display: none; padding-left: 16px;}f-treeview f-treeview-node input[type='checkbox'] { position: absolute; width: 100%; height: 24px; margin-top: 0px; background: none; box-shadow: none; cursor: default; width: calc( 100% + 100px ); padding-top: 3px; margin-left: -100px;}f-treeview f-treeview-node input[type='checkbox']:checked ~ f-treeview-children { display: block;}f-treeview f-arrow { border: solid #999; border-width: 0 2px 2px 0; display: inline-block; padding: 3px; position: absolute; right: 10px; margin-top: 8px; transform: rotate( -45deg ); transition: all 0.1s ease; pointer-events: none;}f-treeview f-treeview-node input[type='checkbox']:checked ~ f-arrow { margin-top: 7px; transform: rotate( 45deg );}f-treeview f-treeview-label { display: flex; align-content: center; width: 100%; height: 22px; background: none; box-shadow: none; cursor: default; width: calc( 100% + 100px ); padding-top: 3px; margin-left: -100px; padding-left: 105px; border-bottom: 1px solid #333; pointer-events: none; z-index: 1;}f-treeview f-treeview-node input[type='checkbox']:hover { background: #2c2c2f;}f-treeview f-treeview-node:has( f-arrow ) > input[type='checkbox'] { background: #2c2c2f;}f-treeview f-treeview-node:has( f-arrow ) > input[type='checkbox']:hover { background: #333339;}f-treeview f-treeview-label { color: #aaa;}f-treeview f-treeview-label spam { margin-top: 1px;}f-treeview f-treeview-label i { color: #ccc; transition: color 0.1s ease; margin-top: 1px;}f-treeview f-treeview-node { position: relative; display: flex; flex-direction: column;}f-treeview f-treeview-node input[type='checkbox']:hover ~ f-treeview-label { color: #eee;}f-treeview f-treeview-node input[type='checkbox']:hover ~ f-treeview-label i { color: #fff;}f-menu.context f-item f-node { position: relative; display: block; width: calc( 100% - 6px ) !important; margin: 3px; animation: unset;}f-treeview f-treeview-node.selected > input[type='checkbox'] { background-color: #014fc5;}f-treeview f-treeview-node.selected > f-treeview-label,f-treeview f-treeview-node.selected > f-treeview-label i { color: #fff;}f-treeview f-treeview-node.selected > input[type='checkbox']:hover { background-color: #06f;}f-string { display: contents;}f-string f-buttons { position: absolute; top: 50%; right: 1px; transform: translateY( -50% );}f-string f-buttons i { color: #999; padding-left: 4px; padding-right: 4px; padding-bottom: 1px; margin-right: 1px; cursor: pointer; background: #252526eb; height: 100%; padding-top: 1px; margin-right: 1px !important;}f-string i[type=icon] { color: #999; position: absolute; right: 8px; top: calc( 50% - 8px ); margin-right: 5px;}f-inputs f-string i[type=icon] { right: 0;}f-string f-buttons i:hover { color: #eeeeee;}f-string input:focus ~ f-string { opacity: .9;}f-string:hover input::placeholder { color: #999;}f-string f-treeview { position: absolute; max-height: 200px; height: 200px; background-color: #000; z-index: 10;}f-drop { width: 100%; height: 100%; position: sticky; left: 0; top: 0; background: #02358417; text-align: center; justify-content: center; align-items: center; display: flex; box-shadow: inset 0 0 20px 10px #464ace17; pointer-events: none; transition: all .07s; opacity: 0; visibility: hidden;}f-drop.visible { visibility: unset; opacity: unset; transition: all .23s;}f-drop span { opacity: .5; font-size: 40px; text-shadow: 0px 0px 5px #000; font-weight: bold;}f-tooltip { pointer-events: none;}f-tooltip { position: absolute; left: 0; top: 0; background: rgba(0,0,0,.8); backdrop-filter: blur(4px); font-size: 14px; padding: 7px; left: 50%; border-radius: 10px; transform: translateX(-50%); visibility: hidden; pointer-events: none; opacity: 0; transition: all 0.3s ease; z-index: 150; white-space: nowrap;}f-menu.context,f-menu.search { position: absolute;}f-menu.context { width: 170px; z-index: 110;}f-menu.search { bottom: 85px; left: 50%; transform: translateX(-50%); z-index: 10; width: 300px;}f-menu.context f-list { display: block; margin: 0; background: #171717e6; font-size: 12px; border-radius: 6px; backdrop-filter: blur(6px); border: 1px solid #7e7e7e45; box-shadow: 3px 3px 6px rgba(0,0,0,.2); transition: opacity 0.2s ease, transform 0.1s ease;}f-menu.search f-list { margin: 0 6px 0 6px; display: flex; flex-direction: column-reverse; margin-bottom: 5px;}f-menu.context.hidden { visibility: hidden; opacity: 0;}f-menu.context f-item,f-menu.search f-item { display: block; position: relative; margin: 0; padding: 0; white-space: nowrap;}f-menu.search f-item { opacity: 0;}f-menu.context f-item.submenu::after { content: \"\"; position: absolute; right: 6px; top: 50%; -webkit-transform: translateY( -50% ); transform: translateY( -50% ); border: 5px solid transparent; border-left-color: #808080;}f-menu.context f-item:hover > f-menu,f-menu.context f-item.active > f-menu { visibility: unset; transform: unset; opacity: unset;}f-menu.context f-menu { top: 0px; left: calc( 100% - 4px );}f-menu.context f-item button,f-menu.search f-item button { overflow: visible; display: block; width: calc( 100% - 6px ); text-align: left; cursor: pointer; white-space: nowrap; padding: 6px 8px; border-radius: 3px; background: rgba(45, 45, 48, 0.95); border: 0; color: #ddd; margin: 3px; text-shadow: 1px 1px 0px #0007;}f-menu.context f-item button i,f-menu.search f-item button i { float: left; font-size: 20px; margin-top: -1px; margin-right: 3px;}f-menu.context f-item button i { height: 18px; margin-top: -2px;}f-menu.context f-item button span,f-menu.search f-item button span { margin-left: 4px;}f-menu.context f-item:hover > button,f-menu.search f-item:hover > button,f-menu.search f-item.active > button { color: #fff; background-color: rgba(61, 70, 82, 0.98);}f-menu.search f-item:hover,f-menu.search f-item.active { opacity: 1 !important;}f-menu.context f-item button:active { outline: solid 1px rgba( 0, 80, 200, 0.98 );}f-menu.context f-item f-tooltip { margin-left: 85px; top: -50px;}f-menu.search f-item { display: none;}f-menu.search f-item:nth-child(1) { opacity: 1; display: unset;}f-menu.search f-item:nth-child(2) { opacity: .8; display: unset;}f-menu.search f-item:nth-child(3) { opacity: .6; display: unset;}f-menu.search f-item:nth-child(4) { opacity: .4; display: unset;}f-menu.search f-item button { border-radius: 14px;}f-tips { right: 10px; top: 10px; position: absolute; z-index: 100; pointer-events: none; display: flex; flex-direction: column;}f-tips f-tip { width: 450px; font-size: 13px; border-radius: 6px; text-align: center; display: block; height: auto; color: #ffffffe0; margin: 4px; padding: 4px; background: #17171794; border: 1px solid #7e7e7e38; line-height: 100%; backdrop-filter: blur(6px); transition: all 0.2s ease; text-transform: initial; opacity: 0;}f-tips f-tip:nth-child(1) { opacity: 1;}f-tips f-tip:nth-child(2) { opacity: .75;}f-tips f-tip:nth-child(3) { opacity: .25;}f-tips f-tip:nth-child(4) { opacity: .1;}f-tips f-tip.error { background: #b900005e;}f-menu.search input { width: calc( 100% - 28px ); height: 41px; position: absolute; z-index: 10; border-radius: 20px; padding-left: 14px; padding-right: 14px; font-size: 15px; background-color: #17171794; border: 1px solid #7e7e7e45; backdrop-filter: blur(6px); box-shadow: 3px 3px 6px rgb(0 0 0 / 20%); text-transform: initial;}f-menu.circle { position: absolute; z-index: 100;}f-menu.circle.top { top: 40px;}f-menu.circle.left { left: 40px;}f-menu.circle.bottom { bottom: 40px;}f-menu.circle.right { right: 40px;}f-menu.circle f-item { align-content: space-around; margin-right: 20px;}f-menu.circle f-item button { width: 46px; height: 46px; font-size: 22px; background: #17171794; border-radius: 50%; backdrop-filter: blur(6px); border: 1px solid #7e7e7e45; line-height: 100%; cursor: pointer; box-shadow: 3px 3px 6px rgba(0,0,0,.2); margin-bottom: 20px;}f-menu.circle f-item f-tooltip { margin-top: -60px;}f-menu.circle.top f-item f-tooltip { margin-top: 50px;}.f-rounded f-node f-element,.f-rounded f-node f-element.title.left { border-radius: 10px 5px 10px 5px;}.f-rounded f-node f-element input, .f-rounded f-node f-element select,.f-rounded f-node f-element button,.f-rounded f-node f-element textarea,.f-rounded f-node f-element input[type='checkbox'].toggle,.f-rounded f-node f-element input[type='checkbox'].toggle:after { border-radius: 20px 10px;}.f-rounded f-node f-element input { padding-left: 7px; padding-right: 7px;}.f-rounded f-menu.context,.f-rounded f-menu.context f-item button { border-radius: 20px 10px;}@media (hover: hover) and (pointer: fine) { f-node:not(.selected):hover { filter: drop-shadow(0 0 6px #66666630); } f-element f-toolbar { visibility: hidden; opacity: 0; transition: opacity 0.2s ease; } body:not(.connecting) f-node:hover > f-element f-toolbar, f-node.selected f-element f-toolbar { visibility: visible; opacity: 1; } f-element f-io:hover { zoom: 1.4; } f-menu.circle f-item button:hover { background-color: #2a2a2a; } f-menu.search input:hover, f-menu.search input:focus { background-color: #1a1a1a; filter: drop-shadow(0 0 6px #66666630); } f-menu.search input:focus { filter: drop-shadow(0 0 8px #4444dd); } f-menu.circle f-item button:hover > f-tooltip, f-menu.context f-item button:hover > f-tooltip { visibility: visible; opacity: 1; } f-menu.circle f-item button:hover > f-tooltip { margin-top: -50px; } f-menu.circle.top f-item button:hover > f-tooltip { margin-top: 60px; } f-menu.context f-item button:hover > f-tooltip { top: -30px; } f-menu.circle f-item button:focus > f-tooltip, f-menu.context f-item button:focus > f-tooltip { visibility: hidden; opacity: 0; }}@media (hover: none) and (pointer: coarse) { body.dragging f-canvas, body.connecting f-canvas { overflow: hidden !important; }}f-element.invalid > f-inputs,f-element.invalid > f-label,f-element.invalid > f-title,f-element.invalid > f-toolbar,f-element.invalid > input,f-element.invalid > select { opacity: .1 !important;}f-canvas { will-change: top, left;}f-node { will-change: transform !important;}"),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).Flow={})}(this,(function(t){"use strict";let e=0;class n extends EventTarget{static get type(){return"Serializer"}constructor(){super(),this._id=e++,this._serializable=!0}get id(){return this._id}setSerializable(t){return this._serializable=t,this}getSerializable(){return this._serializable}serialize(){console.warn("Serializer: Abstract function.")}deserialize(){console.warn("Serializer: Abstract function.")}deserializeLib(){}get className(){return this.constructor.type||this.constructor.name}toJSON(t=null){let e=null;const n=this.id;if(null!==t){const i=t.objects;e=i[n],void 0===e&&(e={objects:i},this.serialize(e),delete e.objects,i[n]=e)}else e={objects:{}},this.serialize(e);return e.id=n,e.type=this.className,e}}const i=(new class{constructor(){this.x=0,this.y=0,this.started=!1,this._onMoveEvent=t=>{const e=t.touches?t.touches[0]:t;this.x=e.clientX,this.y=e.clientY}}start(){if(!this.started)return this.started=!0,window.addEventListener("wheel",this._onMoveEvent,!0),window.addEventListener("mousedown",this._onMoveEvent,!0),window.addEventListener("touchstart",this._onMoveEvent,!0),window.addEventListener("mousemove",this._onMoveEvent,!0),window.addEventListener("touchmove",this._onMoveEvent,!0),window.addEventListener("dragover",this._onMoveEvent,!0),this}}).start(),s=(t,e=null,n={})=>{n=Object.assign({className:"dragging",click:!1,bypass:!1},n);let i=null;const{className:s,click:o,bypass:r}=n,l=n=>{const s=n.touches?n.touches[0]:n;!1===r&&n.stopImmediatePropagation(),i={client:{x:s.clientX,y:s.clientY},delta:{x:0,y:0},start:{x:t.offsetLeft,y:t.offsetTop},frame:0,isDown:!0,dragging:!1,isTouch:!!n.touches},!0===o&&(e(i),i.frame++),window.addEventListener("mousemove",a),window.addEventListener("mouseup",c),window.addEventListener("touchmove",a),window.addEventListener("touchend",c)},a=n=>{const{start:o,delta:l,client:a}=i,c=n.touches?n.touches[0]:n,h=(()=>{let e=t;for(;e&&e!==document;){const t=e.style.zoom;if(t)return Number(t);e=e.parentNode}return 1})();l.x=(c.clientX-a.x)/h,l.y=(c.clientY-a.y)/h,i.x=o.x+l.x,i.y=o.y+l.y,!0===i.dragging?(null!==e?(e(i),i.frame++):t.style.cssText+=`; left: ${i.x}px; top: ${i.y}px;`,!1===r&&n.stopImmediatePropagation()):(Math.abs(l.x)>2||Math.abs(l.y)>2)&&(i.dragging=!0,t.classList.add("drag"),s&&document.body.classList.add(...s.split(" ")),!1===r&&n.stopImmediatePropagation())},c=n=>{!1===r&&n.stopImmediatePropagation(),t.classList.remove("drag"),s&&document.body.classList.remove(...s.split(" ")),window.removeEventListener("mousemove",a),window.removeEventListener("mouseup",c),window.removeEventListener("touchmove",a),window.removeEventListener("touchend",c),null===e&&(t.removeEventListener("mousedown",l),t.removeEventListener("touchstart",l)),i.dragging=!1,i.isDown=!1,null!==e&&(e(i),i.frame++)};if(t instanceof Event){const e=t;t=e.target,l(e)}else t.addEventListener("mousedown",l),t.addEventListener("touchstart",l)},o=(t,...e)=>{for(const n of t)if(!1===n(...e))return!1;return!0},r=t=>(!1===isNaN(t)&&(t=`${t}px`),t),l=t=>(!1===isNaN(t)&&(t=`#${t.toString(16).padStart(6,"0")}`),t),a=(t,e)=>{e&&e.split(" ").forEach((e=>t.classList.remove(e)))},c=(t,e)=>{e&&e.split(" ").forEach((e=>t.classList.add(e)))};var h=Object.freeze({__proto__:null,pointer:i,draggableDOM:s,dispatchEventList:o,numberToPX:r,numberToHex:l,rgbaToArray:t=>t.substring(t.indexOf("(")+1,t.indexOf(")")).split(",").map((t=>parseInt(t.trim()))),removeDOMClass:a,addDOMClass:c});class d{constructor(t=null,e=null,n=null){this.inputElement=t,this.outputElement=e,this.disconnectDOM=n}get lioElement(){return"left"===d.InputDirection?this.outputElement:this.inputElement}get rioElement(){return"left"===d.InputDirection?this.inputElement:this.outputElement}}d.InputDirection="left";let u=null;const p=t=>t.baseElement||t;class f extends n{static get type(){return"Element"}constructor(t=!1){super(),this.isElement=!0;const e=document.createElement("f-element");e.element=this;const n=t=>{let e=this;if(t.changedTouches&&t.changedTouches.length>0){const n=t.changedTouches[0];let i=document.elementFromPoint(n.clientX,n.clientY);for(;i&&(!i.element||!i.element.isElement);)i=i.parentNode;e=i?i.element:null}const n=t.type;u="mouseout"===n&&u===e?null:e};!1===t&&(e.ontouchstart=e.onmousedown=t=>{t.stopPropagation()}),e.addEventListener("mouseup",n,!0),e.addEventListener("mouseover",n),e.addEventListener("mouseout",n),e.addEventListener("touchmove",n),e.addEventListener("touchend",n),this._bounds={x:0,y:0,width:0,height:0,_x:0,_y:0,_width:0,_height:0},this.inputs=[],this.links=[],this.dom=e,this.lioLength=0,this.rioLength=0,this.events={connect:[],connectChildren:[],valid:[]},this.node=null,this.style="",this.color=null,this.object=null,this.objectCallback=null,this.enabledInputs=!0,this.multiConnections=!1,this.visible=!0,this.inputsDOM=e,this.connections=null,this.lioDOM=this._createIO("lio"),this.rioDOM=this._createIO("rio"),this.dom.classList.add(`input-${d.InputDirection}`),this.addEventListener("connect",(()=>{o(this.events.connect,this)})),this.addEventListener("connectChildren",(()=>{o(this.events.connectChildren,this)})),this.setHeight(24)}setAttribute(t,e){return this.dom.setAttribute(t,e),this}onValid(t){return this.events.valid.push(t),this}onConnect(t,e=!1){return this.events.connect.push(t),e&&this.events.connectChildren.push(t),this}setObjectCallback(t){return this.objectCallback=t,this}setObject(t){return this.object=t,this}getObject(t=null){return this.objectCallback?this.objectCallback(t):this.object}setVisible(t){return this.visible=t,this.dom.style.display=t?"":"none",this}getVisible(){return this.visible}setEnabledInputs(t){const e=this.dom;return this.enabledInputs||e.classList.remove("inputs-disable"),t||e.classList.add("inputs-disable"),this.enabledInputs=t,this}getEnabledInputs(){return this.enabledInputs}setColor(t){return this.dom.style["background-color"]=l(t),this.color=null,this}getColor(){if(null===this.color){const t=window.getComputedStyle(this.dom);this.color=t.getPropertyValue("background-color")}return this.color}setStyle(t){const e=this.dom;return this.style&&e.classList.remove(this.style),t&&e.classList.add(t),this.style=t,this.color=null,this}setMultiConnections(t){return this.multiConnections=t,this}getMultiConnections(){return this.multiConnections}setInput(t){return"left"===d.InputDirection?this.setLIO(t):this.setRIO(t)}setInputColor(t){return"left"===d.InputDirection?this.setLIOColor(t):this.setRIOColor(t)}setOutput(t){return"left"===d.InputDirection?this.setRIO(t):this.setLIO(t)}setOutputColor(t){return"left"===d.InputDirection?this.setRIOColor(t):this.setLIOColor(t)}get inputLength(){return"left"===d.InputDirection?this.lioLength:this.rioLength}get outputLength(){return"left"===d.InputDirection?this.rioLength:this.lioLength}setLIOColor(t){return this.lioDOM.style["border-color"]=l(t),this}setLIO(t){return this.lioLength=t,this.lioDOM.style.visibility=t>0?"":"hidden",t>0?(this.dom.classList.add("lio"),this.dom.prepend(this.lioDOM)):(this.dom.classList.remove("lio"),this.lioDOM.remove()),this}getLIOColor(){return this.lioDOM.style["border-color"]}setRIOColor(t){return this.rioDOM.style["border-color"]=l(t),this}getRIOColor(){return this.rioDOM.style["border-color"]}setRIO(t){return this.rioLength=t,this.rioDOM.style.visibility=t>0?"":"hidden",t>0?(this.dom.classList.add("rio"),this.dom.prepend(this.rioDOM)):(this.dom.classList.remove("rio"),this.rioDOM.remove()),this}add(t){return this.inputs.push(t),t.element=this,this.inputsDOM.append(t.dom),this}setHeight(t){return this.dom.style.height=r(t),this._bounds._height=t,this.dispatchEvent(new Event("resize")),this}getHeight(){return this._bounds._height}getBounds(){const t=this._bounds;if(t.x=this._bounds._x,t.y=this._bounds._y,t.width=this._bounds._width,t.height=this._bounds._height,null!==this.node){const e=this.node.getBounds();t.x+=e.x,t.y+=e.y,t.width=e.width}return t}getConnections(){return this.connections||(this.connections=new Map)}clear(){for(const t of this.getConnections().keys())this.disconnect(t);return this}disconnect(t){const e=this.getConnections();if(t=p(t),!e.has(t))return this;const{disconnectDOM:n}=e.get(t);n.dispatchEvent(new Event("disconnect")),this.dispatchEvent(new Event("connect"))}connect(t=null){if(null===t)return this.clear();t=p(t);const e=this.getConnections();if(!1===this.multiConnections&&e.size>0&&this.clear(),e.has(t))return this;if(!1===o(this.events.valid,this,t,"connect"))return!1;const n=document.createElement("f-disconnect");n.innerHTML=f.icons.unlink?`<i class='${f.icons.unlink}'></i>`:"âœ–",this.dom.append(n);const i=new d(this,t,n);this.links.push(i),e.set(t,{disconnectDOM:n});const s=()=>{e.delete(t),this.links.splice(this.links.indexOf(i),1),this.dom.removeChild(n),n.removeEventListener("mousedown",a,!0),n.removeEventListener("touchstart",a,!0),n.removeEventListener("disconnect",s,!0),t.removeEventListener("connect",r),t.removeEventListener("connectChildren",r),t.removeEventListener("nodeConnect",r),t.removeEventListener("nodeConnectChildren",r),t.removeEventListener("dispose",l)},r=()=>{this.dispatchEvent(new Event("connectChildren"))},l=()=>{this.disconnect(t)},a=e=>{e.stopPropagation(),this.disconnect(t)};return n.addEventListener("mousedown",a,!0),n.addEventListener("touchstart",a,!0),n.addEventListener("disconnect",s,!0),t.addEventListener("connect",r),t.addEventListener("connectChildren",r),t.addEventListener("nodeConnect",r),t.addEventListener("nodeConnectChildren",r),t.addEventListener("dispose",l),this.dispatchEvent(new Event("connect")),!0}dispose(){this.dispatchEvent(new Event("dispose"))}getInputByProperty(t){for(const e of this.inputs)if(e.getProperty()===t)return e}serialize(t){const e=[],n=[],i=[];for(const i of this.inputs){const s=i.toJSON(t).id,o=i.getProperty();e.push(s),null!==o&&n.push({property:o,id:s})}for(const e of this.links)null!==e.inputElement&&null!==e.outputElement&&i.push(e.outputElement.toJSON(t).id);this.inputLength>0&&(t.inputLength=this.inputLength),this.outputLength>0&&(t.outputLength=this.outputLength),e.length>0&&(t.inputs=e),n.length>0&&(t.properties=n),i.length>0&&(t.links=i),""!==this.style&&(t.style=this.style),t.height=this.getHeight()}deserialize(t){if(void 0!==t.inputLength&&this.setInput(t.inputLength),void 0!==t.outputLength&&this.setOutput(t.outputLength),void 0!==t.properties)for(const{id:e,property:n}of t.properties)t.objects[e]=this.getInputByProperty(n);else if(void 0!==t.inputs){const e=this.inputs;if(e.length>0){let n=0;for(const i of t.inputs)t.objects[i]=e[n++]}else for(const e of t.inputs)this.add(t.objects[e])}if(void 0!==t.links)for(const e of t.links)this.connect(t.objects[e]);void 0!==t.style&&this.setStyle(t.style),void 0!==t.height&&this.setHeight(t.height)}getLinkedObject(t=null){const e=this.getLinkedElement();return e?e.getObject(t):null}getLinkedObjects(t=null){return this.getLinkedElements().map((e=>e.getObject(t)))}getLinkedElements(){return[...this.getConnections().keys()]}getLinkedElement(){const t=this.getLink();return t?t.outputElement:null}getLink(){return this.links[0]}_createIO(t){const{dom:e}=this,n=document.createElement("f-io");n.style.visibility="hidden",n.className=t;const i=i=>{i.preventDefault(),i.stopPropagation(),u=null;const r=this.node.dom;r.classList.add("io-connect"),n.classList.add("connect"),e.classList.add("select");const l="left"===d.InputDirection?"lio":"rio",a=t===l?new d(this):new d(null,this),c=new d(a.inputElement,a.outputElement);this.links.push(a),s(i,(i=>{c.outputElement&&c.outputElement.dom.classList.remove("invalid"),c.inputElement&&c.inputElement.dom.classList.remove("invalid"),c.inputElement=a.inputElement,c.outputElement=a.outputElement,t===l?c.outputElement=u:c.inputElement=u;const s=null!==c.inputElement&&null!==c.outputElement&&c.inputElement.inputLength>0&&c.outputElement.outputLength>0&&!1===o(c.inputElement.events.valid,c.inputElement,c.outputElement,i.dragging?"dragging":"dragged");if(i.dragging&&s)t===l?c.outputElement&&c.outputElement.dom.classList.add("invalid"):c.inputElement&&c.inputElement.dom.classList.add("invalid");else if(!i.dragging&&(r.classList.remove("io-connect"),n.classList.remove("connect"),e.classList.remove("select"),this.links.splice(this.links.indexOf(a),1),null!==u&&!s)){if(a.inputElement=c.inputElement,a.outputElement=c.outputElement,a.outputElement.node.isCircular(a.inputElement.node))return;a.inputElement.inputLength>0&&a.outputElement.outputLength>0&&a.inputElement.connect(a.outputElement)}}),{className:"connecting"})};return n.addEventListener("mousedown",i,!0),n.addEventListener("touchstart",i,!0),n}}f.icons={unlink:""};class m extends n{static get type(){return"Input"}constructor(t){super(),this.dom=t,this.element=null,this.extra=null,this.tagColor=null,this.property=null,this.events={change:[],click:[]},this.addEventListener("change",(()=>{o(this.events.change,this)})),this.addEventListener("click",(()=>{o(this.events.click,this)}))}setExtra(t){return this.extra=t,this}getExtra(){return this.extra}setProperty(t){return this.property=t,this}getProperty(){return this.property}setTagColor(t){return this.tagColor=t,this.dom.style["border-left"]=`2px solid ${t}`,this}getTagColor(){return this.tagColor}setToolTip(t){const e=document.createElement("f-tooltip");return e.innerText=t,this.dom.append(e),this}onChange(t){return this.events.change.push(t),this}onClick(t){return this.events.click.push(t),this}setReadOnly(t){return this.getInput().readOnly=t,this}getReadOnly(){return this.getInput().readOnly}setValue(t,e=!0){return this.getInput().value=t,e&&this.dispatchEvent(new Event("change")),this}getValue(){return this.getInput().value}getInput(){return this.dom}serialize(t){t.value=this.getValue()}deserialize(t){this.setValue(t.value)}}m.prototype.isInput=!0;class g extends n{static get type(){return"Node"}constructor(){super();const t=document.createElement("f-node"),e=()=>{const t=this.canvas;null!==t&&t.select(this)};t.addEventListener("mousedown",e,!0),t.addEventListener("touchstart",e,!0),this._onConnect=t=>{const{target:e}=t;for(const t of this.elements)t!==e&&t.dispatchEvent(new Event("nodeConnect"))},this._onConnectChildren=t=>{const{target:e}=t;for(const t of this.elements)t!==e&&t.dispatchEvent(new Event("nodeConnectChildren"))},this._onResize=()=>{this.updateSize()},this.dom=t,this.style="",this.canvas=null,this.resizable=!1,this.serializePriority=0,this.elements=[],this.events={focus:[],blur:[]},this._bounds={x:0,y:0,width:0,height:0,_x:0,_y:0,_width:0,_height:0},this.setWidth(300).setPosition(0,0)}get baseElement(){return this.elements[0]}setAlign(t){const e=this.dom,n=e.style;if(n.left="",n.top="",n.animation="none","string"==typeof t)e.classList.add(t);else if(t)for(const e in t)n[e]=t[e];return this}setResizable(t){return this.resizable=!0===t,this.resizable?this.dom.classList.add("resizable"):this.dom.classList.remove("resizable"),this.updateSize(),this}onFocus(t){return this.events.focus.push(t),this}onBlur(t){return this.events.blur.push(t),this}setStyle(t){const e=this.dom;return this.style&&e.classList.remove(this.style),t&&e.classList.add(t),this.style=t,this}setPosition(t,e){const n=this.dom;return n.style.left=r(t),n.style.top=r(e),this._bounds._x=t,this._bounds._y=e,this}getPosition(){return this._bounds.x=this._bounds._x,this._bounds.y=this._bounds._y,this._bounds}setWidth(t){return this.dom.style.width=r(t),this._bounds._width=t,this.updateSize(),this}getWidth(){return this._bounds.width=this._bounds._width,this._bounds.width}getHeight(){return this.getBounds().height}getBounds(){const t=this._bounds;if(t.x=t._x,t.y=t._y,t.width=t._width,t.height=t._height,null!==this.canvas){const{scrollLeft:e,scrollTop:n}=this.canvas;t.x+=e,t.y+=n}return t}getBounding(){const t=this._bounds;return t.x=t._x,t.y=t._y,t.width=t._width,t.height=t._height,t}add(t){return this.elements.push(t),t.node=this,t.addEventListener("connect",this._onConnect),t.addEventListener("connectChildren",this._onConnectChildren),t.addEventListener("resize",this._onResize),this.dom.append(t.dom),this.updateSize(),this}remove(t){return this.elements.splice(this.elements.indexOf(t),1),t.node=null,t.removeEventListener("connect",this._onConnect),t.removeEventListener("connectChildren",this._onConnectChildren),t.removeEventListener("resize",this._onResize),this.dom.removeChild(t.dom),this.updateSize(),this}dispose(){const t=this.canvas;null!==t&&t.remove(this);for(const t of this.elements)t.dispose();this.dispatchEvent(new Event("dispose"))}isCircular(t){if(t===this)return!0;const e=this.getLinks();for(const n of e)if(n.outputElement.node.isCircular(t))return!0;return!1}getLinks(){const t=[];for(const e of this.elements)t.push(...e.links);return t}getColor(){return this.elements.length>0?this.elements[0].getColor():null}getOuterSize(){return 6}updateSize(){let t=0;for(const e of this.elements)e.dom.style.width="",e._bounds._y=t,t+=e.getHeight()+g.BORDER;if(this._bounds._height=t,!0===this.resizable){const t=this.elements[this.elements.length-1];void 0!==t&&(t.dom.style.width=this.dom.style.width)}}serialize(t){const{x:e,y:n}=this.getPosition(),i=[];for(const e of this.elements)i.push(e.toJSON(t).id);t.x=e,t.y=n,t.width=this.getWidth(),t.elements=i,t.autoResize=this.resizable,""!==this.style&&(t.style=this.style)}deserialize(t){this.setPosition(t.x,t.y),this.setWidth(t.width),this.setResizable(t.autoResize),void 0!==t.style&&this.setStyle(t.style);const e=this.elements;if(e.length>0){let n=0;for(const i of t.elements)t.objects[i]=e[n++]}else for(const e of t.elements)this.add(t.objects[e])}}g.prototype.isNode=!0,g.BORDER=6;class v extends f{static get type(){return"DraggableElement"}constructor(t=!0){super(!0),this.draggable=t;const e=t=>{t.preventDefault(),!0===this.draggable&&s(this.node.dom,(t=>{this.node.setPosition(t.x,t.y)}),{className:"dragging node"})},{dom:n}=this;n.addEventListener("mousedown",e,!0),n.addEventListener("touchstart",e,!0)}}class b extends v{static get type(){return"TitleElement"}constructor(t,e=!0){super(e);const{dom:n}=this;n.classList.add("title");n.addEventListener("dblclick",(()=>{this.node.canvas.focusSelected=!this.node.canvas.focusSelected}));const i=document.createElement("f-title");i.innerText=t;const s=document.createElement("i"),o=document.createElement("f-toolbar");this.buttons=[],this.titleDOM=i,this.iconDOM=s,this.toolbarDOM=o,n.append(i),n.append(s),n.append(o),this.setHeight(29)}setIcon(t){return this.iconDOM.className=t,this}getIcon(){return this.iconDOM.className}setTitle(t){return this.titleDOM.innerText=t,this}getTitle(){return this.titleDOM.innerText}addButton(t){return this.buttons.push(t),this.toolbarDOM.append(t.dom),this}serialize(t){super.serialize(t);const e=this.getTitle(),n=this.getIcon();t.title=e,""!==n&&(t.icon=n)}deserialize(t){super.deserialize(t),this.setTitle(t.title),void 0!==t.icon&&this.setIcon(t.icon)}}const x=(t,e,n,i,s,o,r,l,a=null)=>{const c=n-t,h=i-e,d=Math.sqrt(c*c+h*h)*(s?-.3:.3);if(l.beginPath(),l.moveTo(t,e),l.bezierCurveTo(t+d,e,n-d,i,n,i),null!==a&&r!==a){const s=l.createLinearGradient(t,e,n,i);s.addColorStop(0,r),s.addColorStop(1,a),l.strokeStyle=s}else l.strokeStyle=r;l.lineWidth=o,l.stroke()},y=["#ff4444","#44ff44","#4444ff"],w=(new g).add(new b("File")).setWidth(250);class E extends n{static get type(){return"Canvas"}constructor(){super();const t=document.createElement("f-canvas"),e=document.createElement("f-content"),n=document.createElement("f-area"),i=document.createElement("f-drop"),r=document.createElement("canvas"),l=document.createElement("canvas"),a=document.createElement("canvas"),c=r.getContext("2d"),h=l.getContext("2d"),d=a.getContext("2d");this.dom=t,this.contentDOM=e,this.areaDOM=n,this.dropDOM=i,this.canvas=r,this.frontCanvas=l,this.mapCanvas=a,this.context=c,this.frontContext=h,this.mapContext=d,this.clientX=0,this.clientY=0,this.relativeClientX=0,this.relativeClientY=0,this.nodes=[],this.selected=null,this.updating=!1,this.droppedItems=[],this.events={drop:[]},this._scrollLeft=0,this._scrollTop=0,this._zoom=1,this._width=0,this._height=0,this._focusSelected=!1,this._mapInfo={scale:1,screen:{}},r.className="background",l.className="frontground",a.className="map",i.innerHTML="<span>drop your file</span>",t.append(i),t.append(r),t.append(l),t.append(e),t.append(n),t.append(a);const u=(t,e=this.clientX,n=this.clientY)=>{t=Math.min(Math.max(t,.2),1),this.scrollLeft-=e/this.zoom-e/t,this.scrollTop-=n/this.zoom-n/t,this.zoom=t};let p=null;t.addEventListener("wheel",(e=>{if(((e,n)=>{do{if(e.classList&&e.classList.contains(n))return!0}while((e=e.parentElement)&&e!==t);return!1})(e.srcElement,"f-scroll"))return;e.preventDefault(),e.stopImmediatePropagation();const n=.003*e.deltaY;u(this.zoom-n)})),t.addEventListener("touchmove",(t=>{if(t.touches&&2===t.touches.length){t.preventDefault(),t.stopImmediatePropagation();const e=(t.touches[0].clientX+t.touches[1].clientX)/2,n=(t.touches[0].clientY+t.touches[1].clientY)/2,i=Math.hypot(t.touches[0].clientX-t.touches[1].clientX,t.touches[0].clientY-t.touches[1].clientY);null===p&&(p={distance:i});const s=.003*(p.distance-i);p.distance=i,u(this.zoom-s,e,n)}})),t.addEventListener("touchstart",(()=>{p=null})),r.addEventListener("touchmove",(t=>{if(t.touches&&1===t.touches.length){t.preventDefault(),t.stopImmediatePropagation();const e=t.touches[0].clientX,n=t.touches[0].clientY;if(null===p){const{scrollLeft:t,scrollTop:i}=this;p={scrollLeft:t,scrollTop:i,clientX:e,clientY:n}}const i=this.zoom;this.scrollLeft=p.scrollLeft+(e-p.clientX)/i,this.scrollTop=p.scrollTop+(n-p.clientY)/i}}));let f=0;const m=t=>{t?0==f++&&(this.droppedItems=[],i.classList.add("visible"),this.add(w)):0==--f&&(i.classList.remove("visible"),this.remove(w))};t.addEventListener("dragenter",(()=>{m(!0)})),t.addEventListener("dragleave",(()=>{m(!1)})),t.addEventListener("dragover",(t=>{t.preventDefault();const{relativeClientX:e,relativeClientY:n}=this,i=w.getWidth()/2;w.setPosition(e-i,n-20)})),t.addEventListener("drop",(t=>{t.preventDefault(),m(!1),this.droppedItems=t.dataTransfer.items,o(this.events.drop,this)})),s(t,(e=>{const{delta:n,isTouch:i}=e;if(!i){void 0===e.scrollTop&&(e.scrollLeft=this.scrollLeft,e.scrollTop=this.scrollTop);const t=this.zoom;this.scrollLeft=e.scrollLeft+n.x/t,this.scrollTop=e.scrollTop+n.y/t}e.dragging?t.classList.add("grabbing"):t.classList.remove("grabbing")}),{className:"dragging-canvas"}),s(a,(t=>{const{scale:e,screen:n}=this._mapInfo;if(void 0===t.scrollLeft){const i=this.mapCanvas.getBoundingClientRect(),s=t.client.x-i.left,o=t.client.y-i.top;if(!1===(s>n.x&&o>n.y&&s<n.x+n.width&&o<n.y+n.height)){const t=this._mapInfo.width/this.mapCanvas.width;let i=-this._mapInfo.left-s*t,r=-this._mapInfo.top-o*(this._mapInfo.height/this.mapCanvas.height);i+=n.width/2/e,r+=n.height/2/e,this.scrollLeft=i,this.scrollTop=r}t.scrollLeft=this.scrollLeft,t.scrollTop=this.scrollTop}this.scrollLeft=t.scrollLeft-t.delta.x/e,this.scrollTop=t.scrollTop-t.delta.y/e}),{click:!0}),this._onMoveEvent=t=>{const e=t.touches?t.touches[0]:t,{zoom:n,rect:i}=this;this.clientX=e.clientX,this.clientY=e.clientY;const s=(this.clientX-i.left)/n,o=(this.clientY-i.top)/n;this.relativeClientX=s-this.scrollLeft,this.relativeClientY=o-this.scrollTop},this._onUpdate=()=>{this.update()},this.start()}getBounds(){const t={x:1/0,y:1/0,width:-1/0,height:-1/0};for(const e of this.nodes){const{x:n,y:i,width:s,height:o}=e.getBounding();t.x=Math.min(t.x,n),t.y=Math.min(t.y,i),t.width=Math.max(t.width,n+s),t.height=Math.max(t.height,i+o)}return t.x=Math.round(t.x),t.y=Math.round(t.y),t.width=Math.round(t.width),t.height=Math.round(t.height),t}get width(){return this._width}get height(){return this._height}get rect(){return this.dom.getBoundingClientRect()}get zoom(){return this._zoom}set zoom(t){this._zoom=t,this.contentDOM.style.zoom=t,1===t?this.dom.classList.remove("zoom"):this.dom.classList.add("zoom"),this.updateMozTransform()}set scrollLeft(t){this._scrollLeft=t,this.contentDOM.style.left=r(t),this.updateMozTransform()}get scrollLeft(){return this._scrollLeft}set scrollTop(t){this._scrollTop=t,this.contentDOM.style.top=r(t),this.updateMozTransform()}get scrollTop(){return this._scrollTop}set focusSelected(t){if(this._focusSelected===t)return;const e=this.dom.classList;this._focusSelected=t,t?e.add("focusing"):e.remove("focusing")}get focusSelected(){return this._focusSelected}get useTransform(){const t=navigator.userAgent;return!(/Safari/.test(t)&&!/Chrome/.test(t))}updateMozTransform(){!1!==this.useTransform&&(this.contentDOM.style["-moz-transform"]="scale("+this.zoom+")",this.contentDOM.style["-moz-transform-origin"]="-"+this.contentDOM.style.left+" -"+this.contentDOM.style.top)}onDrop(t){return this.events.drop.push(t),this}start(){this.updating=!0,document.addEventListener("wheel",this._onMoveEvent,!0),document.addEventListener("mousedown",this._onMoveEvent,!0),document.addEventListener("touchstart",this._onMoveEvent,!0),document.addEventListener("mousemove",this._onMoveEvent,!0),document.addEventListener("touchmove",this._onMoveEvent,!0),document.addEventListener("dragover",this._onMoveEvent,!0),requestAnimationFrame(this._onUpdate)}stop(){this.updating=!1,document.removeEventListener("wheel",this._onMoveEvent,!0),document.removeEventListener("mousedown",this._onMoveEvent,!0),document.removeEventListener("touchstart",this._onMoveEvent,!0),document.removeEventListener("mousemove",this._onMoveEvent,!0),document.removeEventListener("touchmove",this._onMoveEvent,!0),document.removeEventListener("dragover",this._onMoveEvent,!0)}add(t){if(t.canvas!==this)return this.nodes.push(t),t.canvas=this,this.contentDOM.append(t.dom),this}remove(t){t===this.selected&&this.select(),this.unlink(t);const e=this.nodes;return e.splice(e.indexOf(t),1),t.canvas=null,this.contentDOM.removeChild(t.dom),t.dispatchEvent(new Event("remove")),this}clear(){const t=this.nodes;for(;t.length>0;)this.remove(t[0]);return this}unlink(t){const e=this.getLinks();for(const n of e)n.inputElement&&n.outputElement&&(n.inputElement.node===t||n.outputElement.node===t)&&n.inputElement.connect()}getLinks(){const t=[];for(const e of this.nodes)t.push(...e.getLinks());return t}centralize(){const t=this.getBounds();return this.scrollLeft=this.canvas.width/2-(-t.x+t.width)/2,this.scrollTop=this.canvas.height/2-(-t.y+t.height)/2,this}setSize(t,e){return this._width=t,this._height=e,this.update(),this}select(t=null){if(t===this.selected)return;const e=this.selected;null!==e&&(this.focusSelected=!1,e.dom.classList.remove("selected"),this.selected=null,o(e.events.blur,e)),null!==t&&(t.dom.classList.add("selected"),this.selected=t,o(t.events.focus,t))}isNodeVisible(t){const{zoom:e,_width:n,_height:i}=this,s=t.getBounds(),o=n/e,r=i/e,l=s.x,a=s.x+s.width,c=s.y,h=s.y+s.height;return!(a<0||l>o||h<0||c>r)}updateNodesVisibility(){const t=new Set;for(const e of this.nodes)this.isNodeVisible(e)&&t.add(e);for(const e of this.nodes){t.has(e)?"none"===e.dom.style.display&&(e.dom.style.animation="none",e.dom.style.display=""):"none"!==e.dom.style.display&&(e.dom.style.animation="none",e.dom.style.display="none")}}updateMap(){const{nodes:t,mapCanvas:e,mapContext:n,scrollLeft:i,scrollTop:s,canvas:o,zoom:r,_mapInfo:l}=this,a=this.getBounds();e.width=300,e.height=200,n.clearRect(0,0,e.width,e.height),n.fillStyle="rgba( 0, 0, 0, 0 )",n.fillRect(0,0,e.width,e.height);const c=-a.x+a.width,h=-a.y+a.height,d=.5*Math.min(e.width/c,e.height/h),u=c*d,p=h*d,f=e.width/2-u/2,m=e.height/2-p/2;let g=null;for(const e of t){const t=e.getBounding(),i=e.getColor();t.x+=-a.x,t.y+=-a.y,t.x*=d,t.y*=d,t.width*=d,t.height*=d,t.x+=f,t.y+=m,e!==this.selected?(n.fillStyle=i,n.fillRect(t.x,t.y,t.width,t.height)):g={nodeBound:t,nodeColor:i}}if(null!==g){const{nodeBound:t,nodeColor:e}=g;n.fillStyle=e,n.fillRect(t.x,t.y,t.width,t.height)}const v=-(i+a.x)*d+f,b=-(s+a.y)*d+m,x=o.width*d/r,y=o.height*d/r;n.fillStyle="rgba( 200, 200, 200, 0.1 )",n.fillRect(v,b,x,y),l.scale=d,l.left=-f/d+a.x,l.top=-m/d+a.y,l.width=e.width/d,l.height=e.height/d,l.screen.x=v,l.screen.y=b,l.screen.width=x,l.screen.height=y}updateLines(){const{dom:t,zoom:e,canvas:n,frontCanvas:i,frontContext:s,context:o,_width:r,_height:l,useTransform:a}=this,c=this.rect;n.width===r&&n.height===l||(n.width=r,n.height=l,i.width=r,i.height=l),o.clearRect(0,0,r,l),s.clearRect(0,0,r,l),o.globalCompositeOperation="lighter",s.globalCompositeOperation="source-over";const h=this.getLinks(),d={x:0,y:0},u={x:0,y:0};let p="";const f=g.BORDER/2;for(const t of h){const{lioElement:n,rioElement:i}=t;let r="",l=0;if(null!==n){const t=n.getBounds();l=Math.max(l,n.rioLength),d.x=t.x+t.width,d.y=t.y+(t.height+f)/2}else d.x=this.clientX,d.y=this.clientY,r="lio";if(null!==i){const t=i.getBounds();l=Math.max(l,i.lioLength),u.x=t.x,u.y=t.y+(t.height+f)/2}else u.x=this.clientX,u.y=this.clientY,r="rio";p=p||r;const a=r?s:o;if(t.disconnectDOM&&(t.inputElement.multiConnections||t.inputElement.links.length>1?(t.disconnectDOM.style.left=-(u.x-d.x)/2+"px",t.disconnectDOM.style.top=-(u.y-d.y)/2+"px"):""!==t.disconnectDOM.style.left&&(t.disconnectDOM.style.left="",t.disconnectDOM.style.top="")),r||1===l){let t=null,s=null;"rio"===r?(t=s=n.getRIOColor(),d.x+=10,u.x/=e,u.y/=e):"lio"===r?(t=s=i.getLIOColor(),u.x-=10,d.x/=e,d.y/=e):(t=n.getRIOColor(),s=i.getLIOColor()),x(d.x*e,d.y*e,u.x*e,u.y*e,!1,2,t||"#ffffff",a,s||"#ffffff")}else{l=Math.min(l,4);for(let t=0;t<l;t++){const s=y[t]||"#ffffff",o=4,r=Math.min(n.rioLength,l),c=Math.min(i.lioLength,l),h=n.getRIOColor()||s,p=i.getLIOColor()||s,f=r*o*.5-o/2,m=c*o*.5-o/2,g=Math.min(t,r-1)*o,v=Math.min(t,c-1)*o;x(d.x*e,(d.y+g-f)*e,u.x*e,(u.y+v-m)*e,!1,2,h,a,p)}}}o.globalCompositeOperation="destination-in",o.fillRect(c.x,c.y,c.width,c.height),""!==p?t.classList.add("dragging-"+p):(t.classList.remove("dragging-lio"),t.classList.remove("dragging-rio"))}update(){!1!==this.updating&&(requestAnimationFrame(this._onUpdate),this.updateNodesVisibility(),this.updateLines(),this.updateMap())}serialize(t){const e=[],n=this.nodes.sort(((t,e)=>t.serializePriority>e.serializePriority?-1:1));for(const i of n)e.push(i.toJSON(t).id);t.nodes=e}deserialize(t){for(const e of t.nodes)this.add(t.objects[e])}}class L extends EventTarget{constructor(t){super();const e=document.createElement("f-menu");e.className=t+" bottom left hidden";const n=document.createElement("f-list");e.append(n),this.dom=e,this.listDOM=n,this.visible=!1,this.align="bottom left",this.subMenus=new WeakMap,this.domButtons=new WeakMap,this.buttons=[],this.events={}}onContext(t){return this.events.context.push(t),this}setAlign(t){const e=this.dom;return a(e,this.align),c(e,t),this.align=t,this}getAlign(){return this.align}show(){return this.dom.classList.remove("hidden"),this.visible=!0,this.dispatchEvent(new Event("show")),this}hide(){this.dom.classList.add("hidden"),this.dispatchEvent(new Event("hide")),this.visible=!1}add(t,e=null){const n=document.createElement("f-item");return null!==e&&(n.classList.add("submenu"),n.append(e.dom),this.subMenus.set(t,e),t.dom.addEventListener("mouseover",(()=>e.show())),t.dom.addEventListener("mouseout",(()=>e.hide()))),n.append(t.dom),this.buttons.push(t),this.listDOM.append(n),this.domButtons.set(t,n),this}clear(){for(this.buttons=[],this.subMenus=new WeakMap,this.domButtons=new WeakMap;this.listDOM.firstChild;)this.listDOM.firstChild.remove()}}let k=null;const M=t=>{k&&!0===k.visible&&null===t.target.closest("f-menu.context")&&k.hide()};document.body.addEventListener("mousedown",M,!0),document.body.addEventListener("touchstart",M,!0);class O extends L{constructor(t=null){super("context"),this.events.context=[],this._lastButtonClick=null,this._onButtonClick=(t=null)=>{const e=t?t.target:null;this._lastButtonClick&&this._lastButtonClick.dom.parentElement.classList.remove("active"),this._lastButtonClick=e,e&&(this.subMenus.has(e)&&this.subMenus.get(e)._onButtonClick(),e.dom.parentElement.classList.add("active"))},this._onButtonMouseOver=t=>{const e=t.target;this.subMenus.has(e)&&this._lastButtonClick!==e&&this._onButtonClick()},this.addEventListener("context",(()=>{o(this.events.context,this)})),this.setTarget(t)}openFrom(t){const e=t.getBoundingClientRect();return this.open(e.x+e.width/2,e.y+e.height/2)}open(t=i.x,e=i.y){return null!==k&&k.hide(),k=this,this.setPosition(t,e),document.body.append(this.dom),this.show()}setWidth(t){return this.dom.style.width=r(t),this}setPosition(t,e){const n=this.dom;return n.style.left=r(t),n.style.top=r(e),this}setTarget(t=null){if(null!==t){const e=t=>{t.preventDefault(),"mouse"!==t.pointerType||0===t.pageX&&0===t.pageY||(this.dispatchEvent(new Event("context")),this.open())};this.target=t,t.addEventListener("contextmenu",e,!1)}return this}show(){this.opened||(this.dom.style.left="",this.dom.style.transform="");const t=this.dom.getBoundingClientRect();let e=Math.min(window.innerWidth-(t.x+t.width+10),0),n=Math.min(window.innerHeight-(t.y+t.height+10),0);return this.opened?(e<0&&(e=-t.width),n<0&&(n=-t.height),this.setPosition(t.x+e,t.y+n)):(e<0&&(this.dom.style.left="-100%"),n<0&&(this.dom.style.transform="translateY( calc( 32px - 100% ) )")),super.show()}hide(){return this.opened&&(k=null),super.hide()}add(t,e=null){return t.addEventListener("click",this._onButtonClick),t.addEventListener("mouseover",this._onButtonMouseOver),super.add(t,e)}get opened(){return k===this}}class z extends L{constructor(){super("circle")}}class _ extends EventTarget{constructor(){super();const t=document.createElement("f-tips");this.dom=t,this.time=0,this.duration=3e3}message(t){return this.tip(t)}error(t){return this.tip(t,"error")}tip(t,e=""){const n=document.createElement("f-tip");return n.className=e,n.innerHTML=t,this.dom.prepend(n),this.time=Math.min(this.time+this.duration,this.duration),setTimeout((()=>{this.time=Math.max(this.time-this.duration,0),n.style.opacity=0,setTimeout((()=>n.remove()),250)}),this.time),this}}const D=t=>t.trim().toLowerCase().replace(/\s\s+/g," ");class C extends L{constructor(){super("search"),this.events.submit=[],this.events.filter=[],this.tags=new WeakMap;const t=document.createElement("input");t.placeholder="Type here";let e=!0,n=!0;t.addEventListener("focusout",(()=>{n=!0,this.setValue("")})),t.onkeydown=n=>{const i=n.key;if("ArrowUp"===i){const t=this.filteredIndex;this.forceAutoComplete?this.filteredIndex=null!==t?(t+1)%(this.filtered.length||1):0:this.filteredIndex=null!==t?Math.min(t+1,this.filtered.length-1):0,n.preventDefault(),e=!1}else if("ArrowDown"===i){const t=this.filteredIndex;this.forceAutoComplete?(this.filteredIndex=t-1,null===this.filteredIndex&&(this.filteredIndex=this.filtered.length-1)):this.filteredIndex=null!==t?t-1:null,n.preventDefault(),e=!1}else"Enter"===i?(this.value=this.currentFiltered?this.currentFiltered.button.getValue():t.value,this.submit(),n.preventDefault(),e=!1):e=!0},t.onkeyup=()=>{e&&(n&&(this.dispatchEvent(new Event("filter")),n=!1),this.filter(t.value))},this.filtered=[],this.currentFiltered=null,this.value="",this.forceAutoComplete=!1,this.dom.append(t),this.inputDOM=t,this.addEventListener("filter",(()=>{o(this.events.filter,this)})),this.addEventListener("submit",(()=>{o(this.events.submit,this)}))}submit(){return this.dispatchEvent(new Event("submit")),this.setValue("")}setValue(t){return this.inputDOM.value=t,this.filter(t),this}getValue(){return this.value}onFilter(t){return this.events.filter.push(t),this}onSubmit(t){return this.events.submit.push(t),this}getFilterByButton(t){for(const e of this.filtered)if(e.button===t)return e;return null}add(t){super.add(t);const e=()=>{const e=this.getFilterByButton(t);this.filteredIndex=this.filtered.indexOf(e),this.value=t.getValue(),this.submit()};return t.dom.addEventListener("mousedown",e),t.dom.addEventListener("touchstart",e),this.domButtons.get(t).remove(),this}set filteredIndex(t){if(this.currentFiltered){this.domButtons.get(this.currentFiltered.button).classList.remove("active"),this.currentFiltered=null}const e=this.filtered[t];if(e){this.domButtons.get(e.button).classList.add("active"),this.currentFiltered=e}this.updateFilter()}get filteredIndex(){return this.currentFiltered?this.filtered.indexOf(this.currentFiltered):null}setTag(t,e){this.tags.set(t,e)}filter(t){t=D(t);const e=this.tags,n=[];for(const i of this.buttons){this.domButtons.get(i).remove();const s=e.has(i)?" "+e.get(i):"",o=D(i.getValue()+s);if(t&&!0===o.includes(t)){const e=t.length/o.length;n.push({button:i,score:e})}}n.sort(((t,e)=>e.score-t.score)),this.filtered=n,this.filteredIndex=this.forceAutoComplete?0:null}updateFilter(){const t=Math.min(this.filteredIndex,this.filteredIndex-3);for(let e=0;e<this.filtered.length;e++){const n=this.filtered[e].button,i=this.domButtons.get(n);i.remove(),e>=t&&this.listDOM.append(i)}}}class I extends f{static get type(){return"LabelElement"}constructor(t="",e=""){super(),this.labelDOM=document.createElement("f-label"),this.inputsDOM=document.createElement("f-inputs");const n=document.createElement("span");this.spanDOM=n,this.iconDOM=null,this.labelDOM.append(n),this.dom.append(this.labelDOM),this.dom.append(this.inputsDOM),this.serializeLabel=!1,this.setLabel(t),this.setAlign(e)}setIcon(t){return this.iconDOM=this.iconDOM||document.createElement("i"),this.iconDOM.className=t,t?this.labelDOM.prepend(this.iconDOM):this.iconDOM.remove(),this}getIcon(){return this.iconDOM?this.iconDOM.className:null}setAlign(t){this.labelDOM.className=t}setLabel(t){this.spanDOM.innerText=t}getLabel(){return this.spanDOM.innerText}serialize(t){if(super.serialize(t),this.serializeLabel){const e=this.getLabel(),n=this.getIcon();t.label=e,""!==n&&(t.icon=n)}}deserialize(t){super.deserialize(t),this.serializeLabel&&(this.setLabel(t.label),void 0!==t.icon&&this.setIcon(t.icon))}}class T extends m{static get type(){return"ButtonInput"}constructor(t=""){const e=document.createElement("button"),n=document.createElement("span");e.append(n);const i=document.createElement("i");e.append(i),super(e),this.spanDOM=n,this.iconDOM=i,n.innerText=t,e.onmouseover=()=>{this.dispatchEvent(new Event("mouseover"))},e.onclick=e.ontouchstart=i.onclick=i.ontouchstart=t=>{t.preventDefault(),t.stopPropagation(),this.dispatchEvent(new Event("click"))}}setIcon(t){return this.iconDOM.className=t,this}getIcon(){return this.iconDOM.className}setValue(t){return this.spanDOM.innerText=t,this}getValue(){return this.spanDOM.innerText}}class S extends m{static get type(){return"ColorInput"}constructor(t=39423){const e=document.createElement("input");super(e),e.type="color",e.value=l(t),e.oninput=()=>{this.dispatchEvent(new Event("change"))}}setValue(t,e=!0){return super.setValue(l(t),e)}getValue(){return parseInt(super.getValue().substr(1),16)}}class N extends m{static get type(){return"NumberInput"}constructor(t=0,e=-1/0,n=1/0,i=.01){const o=document.createElement("input");super(o),this.min=e,this.max=n,this.step=i,this.integer=!1,o.type="text",o.className="number",o.value=this._getString(t),o.spellcheck=!1,o.autocomplete="off",o.ondragstart=o.oncontextmenu=t=>{t.preventDefault(),t.stopPropagation()},o.onfocus=o.onclick=()=>{o.select()},o.onblur=()=>{this.dom.value=this._getString(this.dom.value),this.dispatchEvent(new Event("blur"))},o.onchange=()=>{this.dispatchEvent(new Event("change"))},o.onkeydown=t=>{if(1===t.key.length&&!0!==/\d|\.|\-/.test(t.key))return!1;"Enter"===t.key&&t.target.blur(),t.stopPropagation()},s(o,(t=>{const{delta:e}=t;if(!0===o.readOnly)return;void 0===t.value&&(t.value=this.getValue());const n=e.x-e.y,i=t.value+n*this.step;o.value=this._getString(i.toFixed(this.precision)),this.dispatchEvent(new Event("change"))}))}setStep(t){return this.step=t,this}setRange(t,e,n){return this.min=t,this.max=e,this.step=n,this.dispatchEvent(new Event("range")),this.setValue(this.getValue())}setInterger(t){return this.integer=t,this.step=.1,this.setValue(this.getValue())}get precision(){if(!0===this.integer)return 0;const t=this.step%1;return 0!==t?t.toString().split(".")[1].length:1}setValue(t,e=!0){return super.setValue(this._getString(t),e)}getValue(){return Number(this.dom.value)}serialize(t){const{min:e,max:n}=this;e!==-1/0&&n!==1/0&&(t.min=this.min,t.max=this.max,t.step=this.step),super.serialize(t)}deserialize(t){if(void 0!==t.min){const{min:t,max:e,step:n}=this;this.setRange(t,e,n)}super.deserialize(t)}_getString(t){const e=Math.min(Math.max(Number(t),this.min),this.max);return!0===this.integer?Math.floor(e):e+(e%1?"":".0")}}class B extends m{static get type(){return"SelectInput"}constructor(t=[],e=null){const n=document.createElement("select");super(n),n.onchange=()=>{this.dispatchEvent(new Event("change"))},n.onmousedown=n.ontouchstart=()=>{this.dispatchEvent(new Event("click"))},this.setOptions(t,e)}setOptions(t,e=null){const n=this.dom,i=n.value;let s=!1;this.options=t,n.innerHTML="";for(let e=0;e<t.length;e++){let o=t[e];"string"==typeof o&&(o={name:o,value:e});const r=document.createElement("option");r.innerText=o.name,r.value=o.value,!1===s&&i===o.value&&(s=!0),n.append(r)}return n.value=null!==e?e:s?i:"",this}getOptions(){return this._options}serialize(t){t.options=[...this.options],super.serialize(t)}deserialize(t){0===this.options.length&&this.setOptions(t.options),super.deserialize(t)}}const V=(t,e)=>.001*(e-t);class j extends m{static get type(){return"SliderInput"}constructor(t=0,e=0,n=100){const i=document.createElement("f-subinputs");super(i),t=Math.min(Math.max(t,e),n);const o=V(e,n),r=document.createElement("input");r.type="range",r.min=e,r.max=n,r.step=o,r.value=t;const l=new N(t,e,n,o);l.dom.className="range-value",l.onChange((()=>{r.value=l.getValue(),this.dispatchEvent(new Event("change"))})),l.addEventListener("range",(()=>{r.min=l.min,r.max=l.max,r.step=l.step,r.value=l.getValue()})),i.append(r),i.append(l.dom),this.rangeDOM=r,this.field=l;const a=()=>{let t=Number(r.value);t!==this.max&&t+this.step>=this.max&&(r.value=t=this.max),this.field.setValue(t)};s(r,(()=>{a(),this.dispatchEvent(new Event("change"))}),{className:""})}get min(){return this.field.min}get max(){return this.field.max}get step(){return this.field.step}setRange(t,e){return this.field.setRange(t,e,V(t,e)),this.dispatchEvent(new Event("range")),this.dispatchEvent(new Event("change")),this}setValue(t,e=!0){return this.field.setValue(t),this.rangeDOM.value=t,e&&this.dispatchEvent(new Event("change")),this}getValue(){return this.field.getValue()}serialize(t){t.min=this.min,t.max=this.max,super.serialize(t)}deserialize(t){const{min:e,max:n}=t;this.setRange(e,n),super.deserialize(t)}}class R extends m{static get type(){return"StringInput"}constructor(t=""){const e=document.createElement("f-string");super(e);const n=document.createElement("input");e.append(n),n.type="text",n.value=t,n.spellcheck=!1,n.autocomplete="off",this._buttonsDOM=null,this._datalistDOM=null,this.iconDOM=null,this.inputDOM=n,this.buttons=[],n.onblur=()=>{this.dispatchEvent(new Event("blur"))},n.onchange=()=>{this.dispatchEvent(new Event("change"))};let i="";n.onkeydown=()=>i=n.value,n.onkeyup=t=>{"Enter"===t.key&&t.target.blur(),t.stopPropagation(),i!==n.value&&this.dispatchEvent(new Event("change"))}}setPlaceHolder(t){return this.inputDOM.placeholder=t,this}setIcon(t){return this.iconDOM=this.iconDOM||document.createElement("i"),this.iconDOM.setAttribute("type","icon"),this.iconDOM.className=t,t?this.dom.prepend(this.iconDOM):this.iconDOM.remove(),this}getIcon(){return this.iconInput?this.iconInput.getIcon():""}addButton(t){return this.buttonsDOM.prepend(t.iconDOM),this.buttons.push(t),this}addOption(t){const e=document.createElement("option");return e.value=t,this.datalistDOM.append(e),this}clearOptions(){this.datalistDOM.remove()}get datalistDOM(){let t=this._datalistDOM;if(null===t){const e="input-dt-"+this.id;t=document.createElement("datalist"),t.id=e,this._datalistDOM=t,this.inputDOM.autocomplete="on",this.inputDOM.setAttribute("list",e),this.dom.prepend(t)}return t}get buttonsDOM(){let t=this._buttonsDOM;return null===t&&(t=document.createElement("f-buttons"),this._buttonsDOM=t,this.dom.prepend(t)),t}getInput(){return this.inputDOM}}class P extends m{static get type(){return"TextInput"}constructor(t=""){const e=document.createElement("textarea");super(e),e.innerText=t,e.classList.add("f-scroll"),e.onblur=()=>{this.dispatchEvent(new Event("blur"))},e.onchange=()=>{this.dispatchEvent(new Event("change"))},e.onkeyup=t=>{t.stopPropagation(),this.dispatchEvent(new Event("change"))}}}class Y extends m{static get type(){return"ToggleInput"}constructor(t=!1){const e=document.createElement("input");super(e),e.type="checkbox",e.className="toggle",e.checked=t,e.onclick=()=>this.dispatchEvent(new Event("click")),e.onchange=()=>this.dispatchEvent(new Event("change"))}setValue(t){return this.dom.checked=t,this.dispatchEvent(new Event("change")),this}getValue(){return this.dom.checked}}class A{constructor(t=""){const e=document.createElement("f-treeview-node"),n=document.createElement("f-treeview-label"),i=document.createElement("input"),s=document.createElement("spam");n.append(s),s.innerText=t,i.type="checkbox",e.append(i),e.append(n),this.dom=e,this.childrenDOM=null,this.labelSpam=s,this.labelDOM=n,this.inputDOM=i,this.iconDOM=null,this.parent=null,this.children=[],this.selected=!1,this.events={change:[],click:[]},e.addEventListener("click",(()=>{o(this.events.click,this)}))}setLabel(t){return this.labelSpam.innerText=t,this}getLabel(){return this.labelSpam.innerText}add(t){let e=this.childrenDOM;if(null===this.childrenDOM){const t=this.dom,n=document.createElement("f-arrow");e=document.createElement("f-treeview-children"),t.append(n),t.append(e),this.childrenDOM=e}return this.children.push(t),e.append(t.dom),t.parent=this,this}setOpened(t){return this.inputDOM.checked=t,this}getOpened(){return this.inputDOM.checkbox}setIcon(t){return this.iconDOM=this.iconDOM||document.createElement("i"),this.iconDOM.className=t,t?this.labelDOM.prepend(this.iconDOM):this.iconDOM.remove(),this}getIcon(){return this.iconDOM?this.iconDOM.className:null}setVisible(t){return this.dom.style.display=t?"":"none",this}setSelected(t){return this.selected===t||(t?this.dom.classList.add("selected"):this.dom.classList.remove("selected"),this.selected=t),this}onClick(t){return this.events.click.push(t),this}}class X extends m{static get type(){return"TreeViewInput"}constructor(t=[]){const e=document.createElement("f-treeview");super(e);const n=document.createElement("f-treeview-children");e.append(n),e.setAttribute("type","tree"),this.childrenDOM=n,this.children=[]}add(t){return this.children.push(t),this.childrenDOM.append(t.dom),this}serialize(t){super.serialize(t)}deserialize(t){super.deserialize(t)}}var F=Object.freeze({__proto__:null,Element:f,Input:m,Node:g,Canvas:E,Serializer:n,Menu:L,ContextMenu:O,CircleMenu:z,Tips:_,Search:C,DraggableElement:v,LabelElement:I,TitleElement:b,ButtonInput:T,ColorInput:S,NumberInput:N,SelectInput:B,SliderInput:j,StringInput:R,TextInput:P,ToggleInput:Y,TreeViewInput:X,TreeViewNode:A});const H={};class W extends EventTarget{static get type(){return"Loader"}constructor(t=W.DEFAULT){super(),this.parseType=t,this.events={load:[]}}setParseType(t){return this.parseType=t,this}getParseType(){return this.parseType}onLoad(t){return this.events.load.push(t),this}async load(t,e={}){return await fetch(t).then((t=>t.json())).then((t=>(this.data=this.parse(t,e),o(this.events.load,this),this.data))).catch((t=>{console.error("Loader:",t)}))}parse(t,e={}){t=this._parseObjects(t,e);const n=this.parseType;if(n===W.DEFAULT){const n=t.type,i=new(e[n]?e[n]:H[n]||F[n]);return i.getSerializable()&&i.deserialize(t),i}if(n===W.OBJECTS)return t}_parseObjects(t,e={}){t={...t};const n={};for(const i in t.objects){const s=t.objects[i];s.objects=n;const o=s.type,r=e[o]?e[o]:H[o]||F[o];r||console.error(`Class "${o}" not found!`),n[i]=new r,n[i].deserializeLib(t.objects[i],e)}const i=new Map,s=(e=null)=>{for(const s in t.objects){const o=n[s];o&&(!1!==i.has(o)||null!==e&&!0!==o[e]||(i.set(o,!0),o.getSerializable()&&o.deserialize(t.objects[s])))}};return s("isNode"),s("isElement"),s("isInput"),s(),t.objects=n,t}}W.DEFAULT="default",W.OBJECTS="objects",t.ButtonInput=T,t.Canvas=E,t.CircleMenu=z,t.ColorInput=S,t.ContextMenu=O,t.DraggableElement=v,t.Element=f,t.Input=m,t.LabelElement=I,t.Loader=W,t.LoaderLib=H,t.Menu=L,t.Node=g,t.NumberInput=N,t.REVISION="3",t.Search=C,t.SelectInput=B,t.Serializer=n,t.SliderInput=j,t.StringInput=R,t.TextInput=P,t.Tips=_,t.TitleElement=b,t.ToggleInput=Y,t.TreeViewInput=X,t.TreeViewNode=A,t.Utils=h,Object.defineProperty(t,"__esModule",{value:!0})}));
