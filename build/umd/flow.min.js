/**
 * https://github.com/sunag/flow
 */
function __flow__addCSS(t){try{const e=document.createElement("style");e.setAttribute("type","text/css"),e.innerHTML=t,document.head.appendChild(e)}catch(t){}}__flow__addCSS("@keyframes f-animation-open { 0% { transform: scale(.5); opacity: 0; } 100% { transform: scale(1); opacity: 1; }}f-canvas,f-canvas canvas { position: absolute; top: 0; left: 0; margin: 0; padding: 0; width: 100%; height: 100%; -webkit-touch-callout: none; }f-canvas { overflow: auto; cursor: grab;}f-canvas canvas.front { z-index: 10;}body.dragging *:not(.drag) { pointer-events: none !important;}f-canvas.grabbing * { cursor: grabbing; user-select: none;}f-canvas canvas { position: fixed; overflow: hidden; pointer-events: none;}f-canvas::-webkit-scrollbar { width: 8px; height: 8px;}f-canvas::-webkit-scrollbar-thumb:hover{ background: #014fc5;}f-canvas::-webkit-scrollbar-track { background: #363636;}f-canvas::-webkit-scrollbar-thumb { background-color: #666666; border-radius: 10px; border: 0;}f-canvas f-content,f-canvas f-area { position: absolute; display: block;}f-node { position: absolute; margin: 0; padding: 0; user-select: none; width: 320px; z-index: 1; cursor: auto; filter: drop-shadow(0 0 10px #00000061); backdrop-filter: blur(4px);}f-node.selected { z-index: 2;}f-node.selected,f-canvas.dragging-rio f-node:hover,f-canvas.dragging-lio f-node:hover { filter: drop-shadow(0 0 10px #00000061) drop-shadow(0 0 8px #4444dd);}f-node.closed f-element:not(:first-child) { display: none;}f-node.center { top: 50%; left: 50%; transform: translate( -50%, -50% );}f-node.top-right { top: 0; right: 0;}f-node.top-center { top: 0; left: 50%; transform: translateX( -50% );}f-node.top-left { top: 0; left: 0;}f-node { transition: filter 0.2s ease;}f-node { animation: .2s f-animation-open 1 alternate ease-out;}f-tips,f-drop,f-menu,f-menu input,f-menu button,f-element,f-element input,f-element select,f-element button,f-element textarea { font-family: 'Open Sans', sans-serif; font-size: 13px; text-transform: capitalize; color: #eeeeee; outline: solid 0px #000; margin: 0; padding: 0; border: 0; user-select: none; -webkit-tap-highlight-color: transparent; transition: background 0.2s ease, filter 0.2s ease;}f-element input:read-only { color: #666;}f-element input,f-element textarea { text-transform: initial;}f-element input { transition: background 0.1s ease;}f-element input,f-element select,f-element button,f-element textarea { background-color: #232324d1;}f-element { position: relative; width: calc( 100% - 14px ); background: rgba(45, 45, 48, 0.95); pointer-events: auto; border-bottom: 2px solid #232323; display: flex; padding-left: 7px; padding-right: 7px; padding-top: 2px; padding-bottom: 2px;}f-element:after,f-element:before { transition: opacity .17s; opacity: 0; content: '';}f-element[tooltip]:hover:after,f-element[tooltip]:focus-within:after { font-size: 14px !important; display: flex; justify-content: center; position: fixed; margin-left: -7px; width: calc( 100% ); background: #1d1d1de8; border: 1px solid #444444a1; border-radius: 6px; color: #dadada; content: attr( tooltip ); margin-top: -41px; font-size: 16px; padding-top: 3px; padding-bottom: 3px; z-index: 10; opacity: 1; backdrop-filter: blur(4px); white-space: nowrap; overflow: hidden; text-shadow: 1px 1px 0px #0007;}f-element[tooltip]:hover:before,f-element[tooltip]:focus-within:before { border: solid; border-color: #1d1d1de8 transparent; border-width: 12px 6px 0 6px; left: calc( 50% - 6px ); bottom: 30px; position: absolute; opacity: 1; z-index: 11;}f-element[error] { background-color: #ff0000;}f-element[error]:hover:after,f-element[error]:focus-within:after { border: none; background-color: #ff0000bb; filter: drop-shadow( 2px 2px 5px #000 ); color: #fff;}f-element[error]:hover:before,f-element[error]:focus-within:before { border-color: #ff0000bb transparent;}f-element { height: 24px;}f-element input { margin-top: 2px; margin-bottom: 2px; box-shadow: inset 0px 1px 1px rgb(0 0 0 / 20%), 0px 1px 0px rgb(255 255 255 / 5%); margin-left: 2px; margin-right: 2px; width: 100%; padding-left: 4px; padding-right: 4px;}f-element input.number { cursor: col-resize;}f-element input:focus[type='text'], f-element input:focus[type='range'], f-element input:focus[type='color'] { background: rgba( 0, 0, 0, 0.6 ); outline: solid 1px rgba( 0, 80, 200, 0.98 );}f-element input[type='color'] { appearance: none; padding: 0; margin-left: 2px; margin-right: 2px; height: calc( 100% - 4px ); margin-top: 2px; border: none;}f-element input[type='color']::-webkit-color-swatch-wrapper { padding: 2px;}f-element input[type='color']::-webkit-color-swatch { border: none; cursor: alias;}f-element input[type='range'] { appearance: none; width: 100%; overflow: hidden; padding: 0; cursor: ew-resize;}f-element input[type='range']::-webkit-slider-runnable-track { appearance: none; height: 10px; color: #13bba4; margin: 0;}f-element input[type='range']::-webkit-slider-thumb { appearance: none; width: 0; background: #434343; box-shadow: -500px 0 0 500px rgba( 0, 120, 255, 0.98 ); border-radius: 50%; border: 0 !important;}f-element input[type='range']::-webkit-slider-runnable-track { margin-left: -4px; margin-right: -5px;}f-element input[type='checkbox'] { appearance: none; cursor: pointer;}f-element input[type='checkbox'].toggle { height: 20px; width: 45px; border-radius: 16px; display: inline-block; position: relative; margin: 0; margin-top: 2px; background: linear-gradient( 0deg, #292929 0%, #0a0a0ac2 100% ); transition: all 0.2s ease;}f-element input[type='checkbox'].toggle:after { content: \"\"; position: absolute; top: 2px; left: 2px; width: 16px; height: 16px; border-radius: 50%; background: white; box-shadow: 0 1px 2px rgba(44, 44, 44, 0.2); transition: all 0.2s cubic-bezier(0.5, 0.1, 0.75, 1.35);}f-element input[type='checkbox'].toggle:checked { background: linear-gradient( 0deg, #0177fb 0%, #0177fb 100% );}f-element input[type='checkbox'].toggle:checked:after { transform: translatex(25px);}f-element.auto-height { display: table;}f-element textarea { width: calc( 100% - 18px ); padding-top: 1px; padding-bottom: 3px; padding-left: 3px; padding-right: 8px; margin-top: 2px; margin-left: 2px; height: calc( 100% - 8px ); max-height: 300px; border-radius: 2px; resize: none; box-shadow: inset 0px 1px 1px rgb(0 0 0 / 20%), 0px 1px 0px rgb(255 255 255 / 5%);}f-element.auto-height textarea { resize: auto;}f-element select { width: 100%; margin-top: 2px; margin-bottom: 2px; margin-left: 2px; margin-right: 2px; cursor: pointer; box-shadow: inset 0px 1px 1px rgb(0 0 0 / 20%), 0px 1px 0px rgb(255 255 255 / 5%);}f-element f-toolbar { position: absolute; display: flex; top: 0; width: 100%; height: 100%; align-content: space-around;}f-element.input-right f-toolbar { right: 7px; float: right; justify-content: end;}f-element f-toolbar { margin-top: auto; margin-bottom: auto; margin-left: 3px; margin-right: 3px; font-size: 18px; line-height: 18px;}f-element f-toolbar button { opacity: .7; cursor: pointer; font-size: 14px; width: unset; height: unset; border-radius: unset; border: unset; outline: 0; background-color: unset; box-shadow: unset;}f-element f-toolbar button:hover,f-element f-toolbar button:active { opacity: 1; border: 0; background-color: unset;}f-element input.range-value { width: 60px; text-align: center;}f-menu.context button,f-element button { width: 100%; height: calc( 100% - 4px ); margin-left: 2px; margin-right: 2px; margin-top: 2px; border-radius: 3px; cursor: pointer;}f-element button { box-shadow: inset 1px 1px 1px 0 rgb(255 255 255 / 17%), inset -2px -2px 2px 0 rgb(0 0 0 / 26%);}f-element button:hover { color: #fff; background-color: #2a2a2a;}f-element button:active { border: 1px solid rgba( 0, 120, 255, 0.98 );}f-element f-inputs,f-element f-subinputs { display: flex; justify-content: flex-end; width: 100%;}f-element f-inputs { left: 100px; top: 50%; transform: translateY(-50%); position: absolute; width: calc( 100% - 106px ); height: calc( 100% - 4px ); z-index: 1;}f-element.inputs-disable f-inputs { filter: grayscale(100%); opacity: .5;}f-element.inputs-disable f-inputs input { pointer-events: none;}f-element f-label,f-element span { margin: auto; text-shadow: 1px 1px 0px #0007;}f-element f-label { padding-left: 4px; white-space: nowrap; position: absolute; top: 50%; transform: translateY(-50%); width: calc( 100% - 20px );}f-element.right f-label { text-align: right;}f-element.center f-label { text-align: center;}f-element f-label i { float: left; font-size: 18px; margin-right: 6px;}f-element f-label.center { width: 100%; text-align: center; display: block;}f-element.title { height: 29px; background-color: #3a3a3ab0; background-color: #3b3b43ed; cursor: all-scroll; border-top-left-radius: 6px; border-top-right-radius: 6px;}f-element.blue { background-color: #014fc5;}f-element.red { background-color: #bd0b0b;}f-element.green { background-color: #148d05;}f-element.yellow { background-color: #d6b100;}f-element.title.left { text-align: left; display: inline-grid; justify-content: start;}f-element.title span { text-align: center; font-size: 15px; padding-top: 2px;}f-element.title i { font-size: 18px; position: absolute; right: 10px; top: 50%; transform: translateY(-50%); opacity: .5;}f-element.title f-toolbar i { font-size: 20px; right: unset; left: 0px;}f-element.input-right.title i { left: 10px; right: unset;}f-element.title.left span { text-align: left;}f-element f-io { border: 2px solid #dadada; width: 7px; height: 7px; position: absolute; background: #242427; border-radius: 8px; float: left; left: -7px; top: calc( 50% - 5px ); cursor: alias; box-shadow: 0 0 3px 2px #0000005e; z-index: 1;}f-element f-io.connect,f-canvas.dragging-rio f-element:hover f-io.lio,f-canvas.dragging-lio f-element:hover f-io.rio { zoom: 1.4;}f-node.io-connect f-io:not(.connect) { border: 2px solid #dadada !important; zoom: 1 !important;}f-element f-io.rio { float: right; right: -7px; left: unset;}f-element f-disconnect { position: absolute; left: -35px; top: 50%; font-size: 22px; transform: translateY( -50% ); filter: drop-shadow(0 0 5px #000); text-shadow: 0px 0px 5px black; cursor: pointer; transition: all .2s;}f-element.input-right f-disconnect { right: -35px; left: unset;}f-element f-disconnect:hover { color: #ff3300;}f-element textarea::-webkit-scrollbar { width: 6px;}f-element textarea::-webkit-scrollbar-track { background: #111; } f-element textarea::-webkit-scrollbar-thumb { background: #0177fb; }f-element textarea::-webkit-scrollbar-thumb:hover { background: #1187ff; }f-element.small { height: 18px;}f-element.large { height: 36px;}body.connecting f-node:not(.io-connect) f-element:hover,f-element.select { background-color: rgba(61, 70, 82, 0.98);}f-element.invalid > f-io { zoom: 1 !important;}f-element.invalid::after { font-size: 14px !important; display: flex; justify-content: center; align-items:center; margin: auto; position: absolute; width: 100%; height: 100%; background: #bd0b0b77; vertical-align: middle; color: #fff; content: 'Not Compatible'; opacity: .95; backdrop-filter: grayscale(100%); white-space: nowrap; overflow: hidden; left: 0; top: 0; text-transform: initial;}f-element.invalid > f-inputs,f-element.invalid > f-label,f-element.invalid > input,f-element.invalid > select { opacity: .1;}f-drop { width: 100%; height: 100%; position: sticky; left: 0; top: 0; background: #02358417; text-align: center; justify-content: center; align-items: center; display: flex; box-shadow: inset 0 0 20px 10px #464ace17; pointer-events: none; transition: all .07s; opacity: 0; visibility: hidden;}f-drop.visible { visibility: unset; opacity: unset; transition: all .23s;}f-drop span { opacity: .5; font-size: 40px; text-shadow: 0px 0px 5px #000; font-weight: bold;}f-tooltip { pointer-events: none;}f-tooltip { position: absolute; left: 0; top: 0; background: rgba(0,0,0,.8); backdrop-filter: blur(4px); font-size: 14px; padding: 7px; left: 50%; border-radius: 10px; transform: translateX(-50%); visibility: hidden; pointer-events: none; opacity: 0; transition: all 0.3s ease; z-index: 150; white-space: nowrap;}f-menu.context,f-menu.search { position: absolute;}f-menu.context { width: 170px; z-index: 110;}f-menu.search { bottom: 85px; left: 50%; transform: translateX(-50%); z-index: 10; width: 300px;}f-menu.context f-list { display: block; margin: 0; background: #171717e6; font-size: 12px; border-radius: 6px; backdrop-filter: blur(6px); border: 1px solid #7e7e7e45; box-shadow: 3px 3px 6px rgba(0,0,0,.2); transition: opacity 0.2s ease, transform 0.1s ease;}f-menu.search f-list { margin: 0 6px 0 6px; display: flex; flex-direction: column-reverse; margin-bottom: 5px;}f-menu.context.hidden { visibility: hidden; opacity: 0;}f-menu.context f-item,f-menu.search f-item { display: block; position: relative; margin: 0; padding: 0; white-space: nowrap;}f-menu.search f-item { opacity: 0;}f-menu.context f-item.submenu::after { content: \"\"; position: absolute; right: 6px; top: 50%; -webkit-transform: translateY(-50%); transform: translateY(-50%); border: 5px solid transparent; border-left-color: #808080;}f-menu.context f-item:hover > f-menu,f-menu.context f-item.active > f-menu { visibility: unset; transform: unset; opacity: unset;}f-menu.context f-menu { top: 0px; left: calc( 100% - 4px );}f-menu.context f-item button,f-menu.search f-item button { overflow: visible; display: block; width: calc( 100% - 6px ); text-align: left; cursor: pointer; white-space: nowrap; padding: 6px 8px; border-radius: 3px; background: rgba(45, 45, 48, 0.95); border: 0; color: #ddd; margin: 3px; text-shadow: 1px 1px 0px #0007;}f-menu.context f-item button i,f-menu.search f-item button i { float: left; font-size: 16px;}f-menu.context f-item button span,f-menu.search f-item button span { margin-left: 6px;}f-menu.context f-item:hover > button,f-menu.search f-item:hover > button,f-menu.search f-item.active > button { color: #fff; background-color: rgba(61, 70, 82, 0.98);}f-menu.search f-item:hover,f-menu.search f-item.active { opacity: 1 !important;}f-menu.context f-item button:active { outline: solid 1px rgba( 0, 80, 200, 0.98 );}f-menu.context f-item f-tooltip { margin-left: 85px; top: -50px;}f-menu.search f-item { display: none;}f-menu.search f-item:nth-child(1) { opacity: 1; display: unset;}f-menu.search f-item:nth-child(2) { opacity: .8; display: unset;}f-menu.search f-item:nth-child(3) { opacity: .6; display: unset;}f-menu.search f-item:nth-child(4) { opacity: .4; display: unset;}f-menu.search f-item button { border-radius: 14px;}f-tips { right: 10px; top: 10px; position: absolute; z-index: 100; pointer-events: none; display: flex; flex-direction: column;}f-tips f-tip { width: 450px; font-size: 13px; border-radius: 6px; text-align: center; display: block; height: auto; color: #ffffffe0; margin: 4px; padding: 4px; background: #17171794; border: 1px solid #7e7e7e38; line-height: 100%; backdrop-filter: blur(6px); transition: all 0.2s ease; text-transform: initial; opacity: 0;}f-tips f-tip:nth-child(1) { opacity: 1;}f-tips f-tip:nth-child(2) { opacity: .75;}f-tips f-tip:nth-child(3) { opacity: .25;}f-tips f-tip:nth-child(4) { opacity: .1;}f-tips f-tip.error { background: #b900005e;}f-menu.search input { width: calc( 100% - 28px ); height: 41px; position: absolute; z-index: 10; border-radius: 20px; padding-left: 14px; padding-right: 14px; font-size: 15px; background-color: #17171794; border: 1px solid #7e7e7e45; backdrop-filter: blur(6px); box-shadow: 3px 3px 6px rgb(0 0 0 / 20%); text-transform: initial;}f-menu.circle { position: absolute; left: 40px; bottom: 40px; z-index: 100;}f-menu.circle f-item { align-content: space-around; margin-right: 20px;}f-menu.circle f-item button { width: 47px; height: 47px; font-size: 22px; background: #17171794; border-radius: 50%; backdrop-filter: blur(6px); border: 1px solid #7e7e7e45; line-height: 100%; cursor: pointer; box-shadow: 3px 3px 6px rgba(0,0,0,.2);}f-menu.circle f-item f-tooltip { margin-top: -60px;}.f-rounded f-node f-element,.f-rounded f-node f-element.title.left { border-radius: 10px 5px 10px 5px;}.f-rounded f-node f-element input, .f-rounded f-node f-element select,.f-rounded f-node f-element button,.f-rounded f-node f-element textarea,.f-rounded f-node f-element input[type='checkbox'].toggle,.f-rounded f-node f-element input[type='checkbox'].toggle:after { border-radius: 20px 10px;}.f-rounded f-node f-element input { padding-left: 7px; padding-right: 7px;}.f-rounded f-menu.context,.f-rounded f-menu.context f-item button { border-radius: 20px 10px;}@media (hover: hover) and (pointer: fine) { f-node:not(.selected):hover { filter: drop-shadow(0 0 6px #66666630); } f-element f-toolbar { visibility: hidden; opacity: 0; transition: opacity 0.2s ease; } f-node:hover > f-element f-toolbar { visibility: visible; opacity: 1; } f-element f-io:hover { zoom: 1.4; } f-menu.circle f-item button:hover { background-color: #2a2a2a; } f-menu.search input:hover, f-menu.search input:focus { background-color: #1a1a1a; filter: drop-shadow(0 0 6px #66666630); } f-menu.search input:focus { filter: drop-shadow(0 0 8px #4444dd); } f-menu.circle f-item button:hover > f-tooltip, f-menu.context f-item button:hover > f-tooltip { visibility: visible; opacity: 1; } f-menu.circle f-item button:hover > f-tooltip { margin-top: -50px; } f-menu.context f-item button:hover > f-tooltip { top: -30px; } f-menu.circle f-item button:focus > f-tooltip, f-menu.context f-item button:focus > f-tooltip { visibility: hidden; opacity: 0; }}@media (hover: none) and (pointer: coarse) { body.dragging f-canvas, body.connecting f-canvas { overflow: hidden !important; }}f-canvas { will-change: top, left;}f-node { will-change: transform !important;}"),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).Flow={})}(this,(function(t){"use strict";const e={icons:{close:"",unlink:""}};let n=0;class i extends EventTarget{constructor(){super(),this._id=n++,this._serializable=!0}get id(){return this._id}setSerializable(t){return this._serializable=t,this}getSerializable(){return this._serializable}serialize(){console.warn("Serializer: Abstract function.")}deserialize(){console.warn("Serializer: Abstract function.")}toJSON(t=null){let e=null;const n=this.id;if(null!==t){const i=t.objects;e=i[n],void 0===e&&(e={objects:i},this.serialize(e),delete e.objects,i[n]=e)}else e={objects:{}},this.serialize(e);return e.id=n,e.type=this.constructor.name,e}}const s=(new class{started=!1;constructor(){this.x=0,this.y=0,this._onMoveEvent=t=>{const e=t.touches?t.touches[0]:t;this.x=e.x,this.y=e.y}}start(){if(!this.started)return this.started=!0,window.addEventListener("wheel",this._onMoveEvent,!0),window.addEventListener("mousedown",this._onMoveEvent,!0),window.addEventListener("touchstart",this._onMoveEvent,!0),window.addEventListener("mousemove",this._onMoveEvent,!0),window.addEventListener("touchmove",this._onMoveEvent,!0),window.addEventListener("dragover",this._onMoveEvent,!0),this}}).start(),o=(t,e=null,n="dragging")=>{let i=null;const s=e=>{const n=e.touches?e.touches[0]:e;e.stopImmediatePropagation(),i={client:{x:n.clientX,y:n.clientY},delta:{x:0,y:0},start:{x:t.offsetLeft,y:t.offsetTop},dragging:!1,isTouch:!!e.touches},window.addEventListener("mousemove",o),window.addEventListener("mouseup",r),window.addEventListener("touchmove",o),window.addEventListener("touchend",r)},o=s=>{const{start:o,delta:r,client:l}=i,a=s.touches?s.touches[0]:s,d=(()=>{let e=t;for(;e&&e!==document;){const t=e.style.zoom;if(t)return Number(t);e=e.parentNode}return 1})();r.x=(a.clientX-l.x)/d,r.y=(a.clientY-l.y)/d,i.x=o.x+r.x,i.y=o.y+r.y,!0===i.dragging?(null!==e?e(i):t.style.cssText+=`; left: ${i.x}px; top: ${i.y}px;`,s.stopImmediatePropagation()):(Math.abs(r.x)>2||Math.abs(r.y)>2)&&(i.dragging=!0,t.classList.add("drag"),n&&document.body.classList.add(n),s.stopImmediatePropagation())},r=l=>{l.stopImmediatePropagation(),t.classList.remove("drag"),n&&document.body.classList.remove(n),window.removeEventListener("mousemove",o),window.removeEventListener("mouseup",r),window.removeEventListener("touchmove",o),window.removeEventListener("touchend",r),null===e&&(t.removeEventListener("mousedown",s),t.removeEventListener("touchstart",s)),i.dragging=!1,null!==e&&e(i)};if(t instanceof Event){const e=t;t=e.target,s(e)}else t.addEventListener("mousedown",s),t.addEventListener("touchstart",s)},r=(t,...e)=>{for(const n of t)if(!1===n(...e))return!1;return!0},l=t=>(!1===isNaN(t)&&(t=`${t}px`),t),a=t=>(!1===isNaN(t)&&(t=`#${t.toString(16).padStart(6,"0")}`),t);var d=Object.freeze({__proto__:null,pointer:s,draggableDOM:o,dispatchEventList:r,toPX:l,toHex:a});class c{constructor(t=null,e=null){this.inputElement=t,this.outputElement=e}get lioElement(){return"left"===c.InputDirection?this.outputElement:this.inputElement}get rioElement(){return"left"===c.InputDirection?this.inputElement:this.outputElement}}c.InputDirection="left";let h=null;class u extends i{constructor(t=!1){super();const e=document.createElement("f-element");e.element=this;const n=t=>{let e=this;if(t.changedTouches&&t.changedTouches.length>0){const n=t.changedTouches[0];let i=document.elementFromPoint(n.clientX,n.clientY);for(;i&&(!i.element||!i.element.isElement);)i=i.parentNode;e=i?i.element:null}const n=t.type;h="mouseout"===n&&h===e?null:e};!1===t&&(e.ontouchstart=e.onmousedown=t=>{t.stopPropagation()}),e.addEventListener("mouseup",n,!0),e.addEventListener("mouseover",n),e.addEventListener("mouseout",n),e.addEventListener("touchmove",n),e.addEventListener("touchend",n),this.inputs=[],this.links=[],this.dom=e,this.lioLength=0,this.rioLength=0,this.events={connect:[],connectChildren:[],valid:[]},this.node=null,this.style="",this.object=null,this.objectCallback=null,this.enabledInputs=!0,this.visible=!0,this.inputsDOM=e,this.disconnectDOM=null,this.lioDOM=this._createIO("lio"),this.rioDOM=this._createIO("rio"),this.dom.classList.add(`input-${c.InputDirection}`),this.dom.append(this.lioDOM),this.dom.append(this.rioDOM),this.addEventListener("connect",(()=>{r(this.events.connect,this)})),this.addEventListener("connectChildren",(()=>{r(this.events.connectChildren,this)}))}setAttribute(t,e){return this.dom.setAttribute(t,e),this}onValid(t){return this.events.valid.push(t),this}onConnect(t,e=!1){return this.events.connect.push(t),e&&this.events.connectChildren.push(t),this}setObjectCallback(t){return this.objectCallback=t,this}setObject(t){return this.object=t,this}getObject(t=null){return this.objectCallback?this.objectCallback(t):this.object}setVisible(t){return this.visible=t,this.dom.style.display=t?"":"none",this}getVisible(){return this.visible}setEnabledInputs(t){const e=this.dom;return this.enabledInputs||e.classList.remove("inputs-disable"),t||e.classList.add("inputs-disable"),this.enabledInputs=t,this}getEnabledInputs(){return this.enabledInputs}setColor(t){return this.dom.style["background-color"]=a(t),this}setStyle(t){const e=this.dom;return this.style&&e.classList.remove(this.style),t&&e.classList.add(t),this.style=t,this}setInput(t){return"left"===c.InputDirection?this.setLIO(t):this.setRIO(t)}setInputColor(t){return"left"===c.InputDirection?this.setLIOColor(t):this.setRIOColor(t)}setOutput(t){return"left"===c.InputDirection?this.setRIO(t):this.setLIO(t)}setOutputColor(t){return"left"===c.InputDirection?this.setRIOColor(t):this.setLIOColor(t)}get inputLength(){return"left"===c.InputDirection?this.lioLength:this.rioLength}get outputLength(){return"left"===c.InputDirection?this.rioLength:this.lioLength}setLIOColor(t){return this.lioDOM.style["border-color"]=a(t),this}setLIO(t){return this.lioLength=t,this.lioDOM.style.visibility=t>0?"":"hidden",this}getLIOColor(){return this.lioDOM.style["border-color"]}setRIOColor(t){return this.rioDOM.style["border-color"]=a(t),this}getRIOColor(){return this.rioDOM.style["border-color"]}setRIO(t){return this.rioLength=t,this.rioDOM.style.visibility=t>0?"":"hidden",this}add(t){return this.inputs.push(t),t.element=this,this.inputsDOM.append(t.dom),this}setHeight(t){return this.dom.style.height=l(t),this}getHeight(){return this.dom.style.height}connect(t=null){if(null!==this.disconnectDOM&&this.disconnectDOM.dispatchEvent(new Event("disconnect")),null!==t){if(!1===r(this.events.valid,this,t,"connect"))return!1;const n=new c(this,t);if(this.links.push(n),null===this.disconnectDOM){this.disconnectDOM=document.createElement("f-disconnect"),this.disconnectDOM.innerHTML=e.icons.unlink?`<i class='${e.icons.unlink}'></i>`:"✖",this.dom.append(this.disconnectDOM);const n=()=>{this.links=[],this.dom.removeChild(this.disconnectDOM),this.disconnectDOM.removeEventListener("mousedown",o,!0),this.disconnectDOM.removeEventListener("touchstart",o,!0),this.disconnectDOM.removeEventListener("disconnect",n,!0),t.removeEventListener("connect",i),t.removeEventListener("connectChildren",i),t.removeEventListener("nodeConnect",i),t.removeEventListener("nodeConnectChildren",i),t.removeEventListener("dispose",s),this.disconnectDOM=null},i=()=>{this.dispatchEvent(new Event("connectChildren"))},s=()=>{this.connect()},o=t=>{t.stopPropagation(),this.connect()};this.disconnectDOM.addEventListener("mousedown",o,!0),this.disconnectDOM.addEventListener("touchstart",o,!0),this.disconnectDOM.addEventListener("disconnect",n,!0),t.addEventListener("connect",i),t.addEventListener("connectChildren",i),t.addEventListener("nodeConnect",i),t.addEventListener("nodeConnectChildren",i),t.addEventListener("dispose",s)}}return this.dispatchEvent(new Event("connect")),!0}dispose(){this.dispatchEvent(new Event("dispose"))}serialize(t){const e=this.getHeight(),n=[],i=[];for(const e of this.inputs)n.push(e.toJSON(t).id);for(const e of this.links)null!==e.inputElement&&null!==e.outputElement&&i.push(e.outputElement.toJSON(t).id);this.inputLength>0&&(t.inputLength=this.inputLength),this.outputLength>0&&(t.outputLength=this.outputLength),n.length>0&&(t.inputs=n),i.length>0&&(t.links=i),""!==this.style&&(t.style=this.style),""!==e&&(t.height=e)}deserialize(t){if(void 0!==t.inputLength&&this.setInput(t.inputLength),void 0!==t.outputLength&&this.setOutput(t.outputLength),void 0!==t.inputs){const e=this.inputs;if(e.length>0){let n=0;for(const i of t.inputs)t.objects[i]=e[n++]}else for(const e of t.inputs)this.add(t.objects[e])}if(void 0!==t.links)for(const e of t.links)this.connect(t.objects[e]);void 0!==t.style&&this.setStyle(t.style),void 0!==t.height&&this.setHeight(t.height)}getLinkedObject(t=null){const e=this.getLinkedElement();return e?e.getObject(t):null}getLinkedElement(){const t=this.getLink();return t?t.outputElement:null}getLink(){return this.links[0]}_createIO(t){const{dom:e}=this,n=document.createElement("f-io");n.style.visibility="hidden",n.className=t;const i=i=>{i.preventDefault(),i.stopPropagation(),h=null;const s=this.node.dom;s.classList.add("io-connect"),n.classList.add("connect"),e.classList.add("select");const l="left"===c.InputDirection?"lio":"rio",a=t===l?new c(this):new c(null,this),d=new c(a.inputElement,a.outputElement);this.links.push(a),o(i,(i=>{d.outputElement&&d.outputElement.dom.classList.remove("invalid"),d.inputElement&&d.inputElement.dom.classList.remove("invalid"),d.inputElement=a.inputElement,d.outputElement=a.outputElement,t===l?d.outputElement=h:d.inputElement=h;const o=null!==d.inputElement&&null!==d.outputElement&&d.inputElement.inputLength>0&&d.outputElement.outputLength>0&&!1===r(d.inputElement.events.valid,d.inputElement,d.outputElement,i.dragging?"dragging":"dragged");if(i.dragging&&o)t===l?d.outputElement&&d.outputElement.dom.classList.add("invalid"):d.inputElement&&d.inputElement.dom.classList.add("invalid");else if(!i.dragging&&(s.classList.remove("io-connect"),n.classList.remove("connect"),e.classList.remove("select"),this.links.splice(this.links.indexOf(a),1),null!==h&&!o)){if(a.inputElement=d.inputElement,a.outputElement=d.outputElement,a.outputElement.node.isCircular(a.inputElement.node))return;a.inputElement.inputLength>0&&a.outputElement.outputLength>0&&a.inputElement.connect(a.outputElement)}}),"connecting")};return n.addEventListener("mousedown",i,!0),n.addEventListener("touchstart",i,!0),n}}u.prototype.isElement=!0;class p extends i{constructor(t){super(),this.dom=t,this.element=null,this.extra=null,this.tagColor=null,this.events={change:[],click:[]},this.addEventListener("change",(()=>{r(this.events.change,this)})),this.addEventListener("click",(()=>{r(this.events.click,this)}))}setExtra(t){return this.extra=t,this}getExtra(){return this.extra}setTagColor(t){return this.tagColor=t,this.dom.style["border-left"]=`2px solid ${t}`,this}getTagColor(){return this.tagColor}setToolTip(t){const e=document.createElement("f-tooltip");return e.innerText=t,this.dom.append(e),this}onChange(t){return this.events.change.push(t),this}onClick(t){return this.events.click.push(t),this}setReadOnly(t){return this.dom.readOnly=t,this}getReadOnly(){return this.dom.readOnly}setValue(t,e=!0){return this.dom.value=t,e&&this.dispatchEvent(new Event("change")),this}getValue(){return this.dom.value}serialize(t){t.value=this.getValue()}deserialize(t){this.setValue(t.value)}}p.prototype.isInput=!0;class m extends i{constructor(){super();const t=document.createElement("f-node"),e=()=>{const t=this.canvas;null!==t&&t.select(this)};t.addEventListener("mousedown",e,!0),t.addEventListener("touchstart",e,!0),this._onConnect=t=>{const{target:e}=t;for(const t of this.elements)t!==e&&t.dispatchEvent(new Event("nodeConnect"))},this._onConnectChildren=t=>{const{target:e}=t;for(const t of this.elements)t!==e&&t.dispatchEvent(new Event("nodeConnectChildren"))},this.dom=t,this.style="",this.canvas=null,this.elements=[],this.events={focus:[],blur:[]},this.setWidth(300).setPosition(0,0)}onFocus(t){return this.events.focus.push(t),this}onBlur(t){return this.events.blur.push(t),this}setStyle(t){const e=this.dom;return this.style&&e.classList.remove(this.style),t&&e.classList.add(t),this.style=t,this}setPosition(t,e){const n=this.dom;return n.style.left=l(t),n.style.top=l(e),this}getPosition(){const t=this.dom;return{x:parseInt(t.style.left),y:parseInt(t.style.top)}}setWidth(t){return this.dom.style.width=l(t),this}getWidth(){return parseInt(this.dom.style.width)}add(t){return this.elements.push(t),t.node=this,t.addEventListener("connect",this._onConnect),t.addEventListener("connectChildren",this._onConnectChildren),this.dom.append(t.dom),this}remove(t){return this.elements.splice(this.elements.indexOf(t),1),t.node=null,t.removeEventListener("connect",this._onConnect),t.removeEventListener("connectChildren",this._onConnectChildren),this.dom.removeChild(t.dom),this}dispose(){const t=this.canvas;null!==t&&t.remove(this);for(const t of this.elements)t.dispose();this.dispatchEvent(new Event("dispose"))}isCircular(t){if(t===this)return!0;const e=this.getLinks();for(const n of e)if(n.outputElement.node.isCircular(t))return!0;return!1}getLinks(){const t=[];for(const e of this.elements)t.push(...e.links);return t}serialize(t){const{x:e,y:n}=this.getPosition(),i=[];for(const e of this.elements)i.push(e.toJSON(t).id);t.x=e,t.y=n,t.width=this.getWidth(),t.elements=i,""!==this.style&&(t.style=this.style)}deserialize(t){this.setPosition(t.x,t.y),this.setWidth(t.width),void 0!==t.style&&this.setStyle(t.style);const e=this.elements;if(e.length>0){let n=0;for(const i of t.elements)t.objects[i]=e[n++]}else for(const e of t.elements)this.add(t.objects[e])}}m.prototype.isNode=!0;class f extends u{constructor(t=!0){super(!0),this.draggable=t;const e=t=>{t.preventDefault(),!0===this.draggable&&o(this.node.dom)},{dom:n}=this;n.addEventListener("mousedown",e,!0),n.addEventListener("touchstart",e,!0)}}class g extends f{constructor(t,e=!0){super(e);const{dom:n}=this;n.className="title";const i=document.createElement("span");i.innerText=t;const s=document.createElement("i"),o=document.createElement("f-toolbar");this.buttons=[],this.spanDOM=i,this.iconDOM=s,this.toolbarDOM=o,n.append(i),n.append(s),n.append(o)}setIcon(t){return this.iconDOM.className=t,this}getIcon(){return this.iconDOM.className}setTitle(t){return this.spanDOM.innerText=t,this}getTitle(){return this.spanDOM.innerText}addButton(t){return this.buttons.push(t),this.toolbarDOM.append(t.dom),this}serialize(t){super.serialize(t);const e=this.getTitle(),n=this.getIcon();t.title=e,""!==n&&(t.icon=n)}deserialize(t){super.deserialize(t),this.setTitle(t.title),void 0!==t.icon&&this.setIcon(t.icon)}}const v=(t,e,n,i,s,o,r,l,a=null)=>{const d=n-t,c=i-e,h=Math.sqrt(d*d+c*c)*(s?-.3:.3);if(l.beginPath(),l.moveTo(t,e),l.bezierCurveTo(t+h,e,n-h,i,n,i),null!==a&&r!==a){const s=l.createLinearGradient(t,e,n,i);s.addColorStop(0,r),s.addColorStop(1,a),l.strokeStyle=s}else l.strokeStyle=r;l.lineWidth=o,l.stroke()},x=["#ff4444","#44ff44","#4444ff"],b=(new m).add(new g("File")).setWidth(250);class E extends i{constructor(){super();const t=document.createElement("f-canvas"),e=document.createElement("f-content"),n=document.createElement("f-area"),i=document.createElement("f-drop"),s=document.createElement("canvas"),a=document.createElement("canvas"),d=s.getContext("2d"),c=a.getContext("2d");this.dom=t,this.contentDOM=e,this.areaDOM=n,this.dropDOM=i,this.canvas=s,this.frontCanvas=a,this.context=d,this.frontContext=c,this.width=1e4,this.height=1e4,this.clientX=0,this.clientY=0,this.relativeClientX=0,this.relativeClientY=0,this.zoom=1,this.nodes=[],this.selected=null,this.updating=!1,this.droppedItems=[],this.events={drop:[]},a.className="front",e.style.left=l(this.centerX),e.style.top=l(this.centerY),n.style.width=`calc( 100% + ${this.width}px )`,n.style.height=`calc( 100% + ${this.height}px )`,i.innerHTML="<span>drop your file</span>",t.append(i),t.append(s),t.append(a),t.append(e),t.append(n);const h=t=>{t.touches?2===t.touches.length&&(t.preventDefault(),t.stopImmediatePropagation()):(t.preventDefault(),t.stopImmediatePropagation())};t.addEventListener("wheel",h),t.addEventListener("touchmove",h);let u=0;const p=t=>{t?0==u++&&(this.droppedItems=[],i.classList.add("visible"),this.add(b)):0==--u&&(i.classList.remove("visible"),this.remove(b))};t.addEventListener("dragenter",(()=>{p(!0)})),t.addEventListener("dragleave",(()=>{p(!1)})),t.addEventListener("dragover",(t=>{t.preventDefault();const{relativeClientX:e,relativeClientY:n}=this,i=b.getWidth()/2;b.setPosition(e-i,n-20)})),t.addEventListener("drop",(t=>{t.preventDefault(),p(!1),this.droppedItems=t.dataTransfer.items,r(this.events.drop,this)})),o(t,(e=>{const{delta:n,isTouch:i}=e;i||(void 0===e.scrollTop&&(e.scrollLeft=t.scrollLeft,e.scrollTop=t.scrollTop),t.scrollLeft=e.scrollLeft-n.x,t.scrollTop=e.scrollTop-n.y),e.dragging?t.classList.add("grabbing"):t.classList.remove("grabbing")}),"dragging-canvas"),this._onMoveEvent=e=>{const n=e.touches?e.touches[0]:e,{zoom:i,rect:s}=this;this.clientX=n.clientX,this.clientY=n.clientY,this.relativeClientX=(t.scrollLeft-this.centerX+n.clientX-s.left)/i,this.relativeClientY=(t.scrollTop-this.centerY+n.clientY-s.top)/i},this._onContentLoaded=()=>{this.centralize()},this._onUpdate=()=>{this.update()},this.start()}get rect(){return this.dom.getBoundingClientRect()}get relativeX(){return this.dom.scrollLeft-this.centerX}get relativeY(){return this.dom.scrollTop-this.centerY}get centerX(){return this.width/2}get centerY(){return this.height/2}onDrop(t){return this.events.drop.push(t),this}start(){this.updating=!0,document.addEventListener("wheel",this._onMoveEvent,!0),document.addEventListener("mousedown",this._onMoveEvent,!0),document.addEventListener("touchstart",this._onMoveEvent,!0),document.addEventListener("mousemove",this._onMoveEvent,!0),document.addEventListener("touchmove",this._onMoveEvent,!0),document.addEventListener("dragover",this._onMoveEvent,!0),document.addEventListener("DOMContentLoaded",this._onContentLoaded),requestAnimationFrame(this._onUpdate)}stop(){this.updating=!1,document.removeEventListener("wheel",this._onMoveEvent,!0),document.removeEventListener("mousedown",this._onMoveEvent,!0),document.removeEventListener("touchstart",this._onMoveEvent,!0),document.removeEventListener("mousemove",this._onMoveEvent,!0),document.removeEventListener("touchmove",this._onMoveEvent,!0),document.removeEventListener("dragover",this._onMoveEvent,!0),document.removeEventListener("DOMContentLoaded",this._onContentLoaded)}add(t){if(t.canvas!==this)return this.nodes.push(t),t.canvas=this,this.contentDOM.append(t.dom),this}remove(t){t===this.selected&&this.select(),this.unlink(t);const e=this.nodes;return e.splice(e.indexOf(t),1),t.canvas=null,this.contentDOM.removeChild(t.dom),t.dispatchEvent(new Event("remove")),this}clear(){const t=this.nodes;for(;t.length>0;)this.remove(t[0]);return this}unlink(t){const e=this.getLinks();for(const n of e)n.inputElement&&n.outputElement&&(n.inputElement.node===t||n.outputElement.node===t)&&n.inputElement.connect()}getLinks(){const t=[];for(const e of this.nodes)t.push(...e.getLinks());return t}centralize(){return this.dom.scroll(this.centerX,this.centerY),this}select(t=null){if(t===this.selected)return;const e=this.selected;null!==e&&(e.dom.classList.remove("selected"),this.selected=null,r(e.events.blur,e)),null!==t&&(t.dom.classList.add("selected"),this.selected=t,r(t.events.focus,t))}update(){if(!1===this.updating)return;requestAnimationFrame(this._onUpdate);const{dom:t,zoom:e,canvas:n,frontCanvas:i,frontContext:s,context:o}=this,r=window.innerWidth,l=window.innerHeight,a=this.rect;n.width===r&&n.height===l||(n.width=r,n.height=l,i.width=r,i.height=l),o.clearRect(0,0,r,l),s.clearRect(0,0,r,l),o.globalCompositeOperation="lighter",s.globalCompositeOperation="source-over";const d=this.getLinks(),c={x:0,y:0},h={x:0,y:0};let u="";for(const t of d){const{lioElement:n,rioElement:i}=t;let r="",l=0;if(null!==n){const t=n.dom.getBoundingClientRect();l=Math.max(l,n.rioLength),c.x=t.x+t.width,c.y=t.y+t.height/2}else c.x=this.clientX,c.y=this.clientY,r="lio";if(null!==i){const t=i.dom.getBoundingClientRect();l=Math.max(l,i.lioLength),h.x=t.x,h.y=t.y+t.height/2}else h.x=this.clientX,h.y=this.clientY,r="rio";u=u||r;const a=r?s:o;if(r||1===l){let t=null,s=null;"rio"===r?(t=s=n.getRIOColor(),c.x+=10,h.x/=e,h.y/=e):"lio"===r?(t=s=i.getLIOColor(),h.x-=10,c.x/=e,c.y/=e):(t=n.getRIOColor(),s=i.getLIOColor()),v(c.x*e,c.y*e,h.x*e,h.y*e,!1,2,t||"#ffffff",a,s||"#ffffff")}else{l=Math.min(l,4);for(let t=0;t<l;t++){const s=x[t]||"#ffffff",o=4,r=Math.min(n.rioLength,l),d=Math.min(i.lioLength,l),u=n.getRIOColor()||s,p=i.getLIOColor()||s,m=r*o*.5-o/2,f=d*o*.5-o/2,g=Math.min(t,r-1)*o-1,b=Math.min(t,d-1)*o-1;v(c.x*e,(c.y+g-m)*e,h.x*e,(h.y+b-f)*e,!1,2,u,a,p)}}}o.globalCompositeOperation="destination-in",o.fillRect(a.x,a.y,a.width,a.height),""!==u?t.classList.add("dragging-"+u):(t.classList.remove("dragging-lio"),t.classList.remove("dragging-rio"))}serialize(t){const e=[];for(const n of this.nodes)e.push(n.toJSON(t).id);t.nodes=e}deserialize(t){for(const e of t.nodes)this.add(t.objects[e])}}class y extends p{constructor(t=""){const e=document.createElement("button"),n=document.createElement("span");e.append(n);const i=document.createElement("i");e.append(i),super(e),this.spanDOM=n,this.iconDOM=i,n.innerText=t,e.onmouseover=()=>{this.dispatchEvent(new Event("mouseover"))},e.onclick=e.ontouchstart=t=>{t.preventDefault(),t.stopPropagation(),this.dispatchEvent(new Event("click"))}}setIcon(t){return this.iconDOM.className=t,this}setValue(t){return this.spanDOM.innerText=t,this}getValue(){return this.spanDOM.innerText}}class w extends m{constructor(t,n,i=null,s=300){super(),this.setWidth(s);const o=new g(t).setObjectCallback(i).setSerializable(!1).setOutput(n),r=new y(e.icons.close||"✕").onClick((()=>{this.dispose()})).setIcon(e.icons.close);o.addButton(r),this.add(o),this.title=o,this.closeButton=r}setName(t){return this.title.setTitle(t),this}getName(){return this.title.getTitle()}setObjectCallback(t){return this.title.setObjectCallback(t),this}getObject(t){return this.title.getObject(t)}setColor(t){return this.title.setColor(t)}setOutputColor(t){return this.title.setOutputColor(t)}invalidate(){this.title.dispatchEvent(new Event("connect"))}}class L extends p{constructor(t=""){const e=document.createElement("input");super(e),e.type="text",e.value=t,e.spellcheck=!1,e.autocomplete="off",e.onblur=()=>{this.dispatchEvent(new Event("blur"))},e.onchange=()=>{this.dispatchEvent(new Event("change"))},e.onkeyup=t=>{13===t.keyCode&&t.target.blur(),t.stopPropagation(),this.dispatchEvent(new Event("change"))}}}class k extends p{constructor(t=0,e=-1/0,n=1/0,i=.01){const s=document.createElement("input");super(s),this.min=e,this.max=n,this.step=i,this.integer=!1,s.type="text",s.className="number",s.value=this._getString(t),s.spellcheck=!1,s.autocomplete="off",s.ondragstart=s.oncontextmenu=t=>{t.preventDefault(),t.stopPropagation()},s.onfocus=s.onclick=()=>{s.select()},s.onblur=()=>{this.dom.value=this._getString(this.dom.value),this.dispatchEvent(new Event("blur"))},s.onchange=()=>{this.dispatchEvent(new Event("change"))},s.onkeydown=t=>{if(1===t.key.length&&!0!==/\d|\./.test(t.key))return!1;13===t.keyCode&&t.target.blur(),t.stopPropagation()},o(s,(t=>{const{delta:e}=t;if(!0===s.readOnly)return;void 0===t.value&&(t.value=this.getValue());const n=e.x-e.y,i=t.value+n*this.step;s.value=this._getString(i.toFixed(this.precision)),this.dispatchEvent(new Event("change"))}))}setStep(t){return this.step=t,this}setRange(t,e,n){return this.min=t,this.max=e,this.step=n,this.dispatchEvent(new Event("range")),this.setValue(this.getValue())}get precision(){if(!0===this.integer)return 0;const t=this.step%1;return 0!==t?t.toString().split(".")[1].length:1}setValue(t,e=!0){return super.setValue(this._getString(t),e)}getValue(){return Number(this.dom.value)}serialize(t){const{min:e,max:n}=this;e!==-1/0&&n!==1/0&&(t.min=this.min,t.max=this.max,t.step=this.step),super.serialize(t)}deserialize(t){if(void 0!==t.min){const{min:t,max:e,step:n}=this;this.setRange(t,e,n)}super.deserialize(t)}_getString(t){const e=Math.min(Math.max(Number(t),this.min),this.max);return!0===this.integer?Math.floor(e):e+(e%1?"":".0")}}const O=(t,e)=>.001*(e-t);class C extends p{constructor(t=0,e=0,n=100){const i=document.createElement("f-subinputs");super(i),t=Math.min(Math.max(t,e),n);const s=O(e,n),r=document.createElement("input");r.type="range",r.min=e,r.max=n,r.step=s,r.value=t;const l=new k(t,e,n,s);l.dom.className="range-value",l.onChange((()=>{r.value=l.getValue()})),l.addEventListener("range",(()=>{r.min=l.min,r.max=l.max,r.step=l.step,r.value=l.getValue()})),i.append(r),i.append(l.dom),this.rangeDOM=r,this.field=l;const a=()=>{let t=Number(r.value);t!==this.max&&t+this.step>=this.max&&(r.value=t=this.max),this.field.setValue(t)};o(r,(()=>{a(),this.dispatchEvent(new Event("change"))}),"")}get min(){return this.field.min}get max(){return this.field.max}get step(){return this.field.step}setRange(t,e){return this.field.setRange(t,e,O(t,e)),this.dispatchEvent(new Event("range")),this.dispatchEvent(new Event("change")),this}setValue(t,e=!0){return this.field.setValue(t),this.rangeDOM.value=t,e&&this.dispatchEvent(new Event("change")),this}getValue(){return this.field.getValue()}serialize(t){t.min=this.min,t.max=this.max,super.serialize(t)}deserialize(t){const{min:e,max:n}=t;this.setRange(e,n),super.deserialize(t)}}class M extends p{constructor(t=39423){const e=document.createElement("input");super(e),e.type="color",e.value=a(t),e.oninput=()=>{this.dispatchEvent(new Event("change"))}}setValue(t,e=!0){return super.setValue(a(t),e)}getValue(){return parseInt(super.getValue().substr(1),16)}}class I extends p{constructor(t=""){const e=document.createElement("textarea");super(e),e.innerText=t,e.onblur=()=>{this.dispatchEvent(new Event("blur"))},e.onchange=()=>{this.dispatchEvent(new Event("change"))},e.onkeyup=t=>{13===t.keyCode&&t.target.blur(),t.stopPropagation(),this.dispatchEvent(new Event("change"))}}}class D extends u{constructor(t="",e=""){super(),this.labelDOM=document.createElement("f-label"),this.inputsDOM=document.createElement("f-inputs");const n=document.createElement("span"),i=document.createElement("i");this.spanDOM=n,this.iconDOM=i,this.labelDOM.append(this.spanDOM),this.labelDOM.append(this.iconDOM),this.dom.append(this.labelDOM),this.dom.append(this.inputsDOM),this.serializeLabel=!1,this.setLabel(t),this.setAlign(e)}setIcon(t){return this.iconDOM.className=t,this}getIcon(){return this.iconDOM.className}setAlign(t){this.labelDOM.className=t}setLabel(t){this.spanDOM.innerText=t}getLabel(){return this.spanDOM.innerText}serialize(t){if(super.serialize(t),this.serializeLabel){const e=this.getLabel(),n=this.getIcon();t.label=e,""!==n&&(t.icon=n)}}deserialize(t){super.deserialize(t),this.serializeLabel&&(this.setLabel(t.label),void 0!==t.icon&&this.setIcon(t.icon))}}class z extends m{constructor(t="Panel",e="top-right"){super();const n=new g(t);this.add(n);const i=new y("🗕");i.onClick((()=>{this.setCollapse(!this.collapsed)})),n.addButton(i),this.collapseButton=i,this.titleElement=n,this.align=e,this.collapsed=!1,this.setAlign(e),this.setStyle("rouded")}setCollapse(t){const e="closed";return this.dom.classList.remove(e),this.collapsed=t,this.collapseButton.value=t?"🗖":"🗕",!0===t&&this.dom.classList.add(e),this}setAlign(t){return this.align&&this.dom.classList.remove(this.align),this.dom.classList.add(t),this.align=t,this}addInput(t,e,n,...i){const s=new t(e[n],...i);return s.onChange((()=>{e[n]=s.value})),this.add(new D(n).add(s)),s}addSlider(t,e,n,i){return this.addInput(C,t,e,n,i)}addNumber(t,e){return this.addInput(k,t,e)}addColor(t,e){return this.addInput(M,t,e)}addString(t,e){return this.addInput(L,t,e)}addText(t,e){const n=this.addInput(I,t,e);return n.element.setHeight(70),n}addButton(t){const e=new y(t);return this.add((new u).setHeight(34).add(e)),e}}class _ extends EventTarget{constructor(t){super();const e=document.createElement("f-menu");e.className=t+" hidden";const n=document.createElement("f-list");e.append(n),this.dom=e,this.listDOM=n,this.visible=!1,this.subMenus=new WeakMap,this.domButtons=new WeakMap,this.buttons=[],this.events={}}onContext(t){return this.events.context.push(t),this}show(){return this.dom.classList.remove("hidden"),this.visible=!0,this.dispatchEvent(new Event("show")),this}hide(){this.dom.classList.add("hidden"),this.dispatchEvent(new Event("hide")),this.visible=!1}add(t,e=null){const n=document.createElement("f-item");return null!==e&&(n.classList.add("submenu"),n.append(e.dom),this.subMenus.set(t,e),t.dom.addEventListener("mouseover",(()=>e.show())),t.dom.addEventListener("mouseout",(()=>e.hide()))),n.append(t.dom),this.buttons.push(t),this.listDOM.append(n),this.domButtons.set(t,n),this}clear(){for(this.buttons=[],this.subMenus=new WeakMap,this.domButtons=new WeakMap;this.listDOM.firstChild;)this.listDOM.firstChild.remove()}}let T=null;const S=t=>{T&&!0===T.visible&&null===t.target.closest("f-menu.context")&&T.hide()};document.body.addEventListener("mousedown",S,!0),document.body.addEventListener("touchstart",S,!0);class j extends _{constructor(t=null){super("context",t),this.events.context=[],this._lastButtonClick=null,this._onButtonClick=(t=null)=>{const e=t?t.target:null;this._lastButtonClick&&this._lastButtonClick.dom.parentElement.classList.remove("active"),this._lastButtonClick=e,e&&(this.subMenus.has(e)&&this.subMenus.get(e)._onButtonClick(),e.dom.parentElement.classList.add("active"))},this._onButtonMouseOver=t=>{const e=t.target;this.subMenus.has(e)&&this._lastButtonClick!==e&&this._onButtonClick()},this.addEventListener("context",(()=>{r(this.events.context,this)})),this.setTarget(t)}openFrom(t){const e=t.getBoundingClientRect();return this.open(e.x+e.width/2,e.y+e.height/2)}open(t=s.x,e=s.y){return null!==T&&T.hide(),T=this,this.setPosition(t,e),document.body.append(this.dom),this.show()}setPosition(t,e){const n=this.dom;return n.style.left=l(t),n.style.top=l(e),this}setTarget(t=null){if(null!==t){const e=t=>{t.preventDefault(),"mouse"!==t.pointerType||0===t.pageX&&0===t.pageY||(this.dispatchEvent(new Event("context")),this.open())};this.target=t,t.addEventListener("contextmenu",e,!1)}return this}show(){this.opened||(this.dom.style.left="",this.dom.style.transform="");const t=this.dom.getBoundingClientRect();let e=Math.min(window.innerWidth-(t.x+t.width+10),0),n=Math.min(window.innerHeight-(t.y+t.height+10),0);return this.opened?(e<0&&(e=-t.width),n<0&&(n=-t.height),this.setPosition(t.x+e,t.y+n)):(e<0&&(this.dom.style.left="-100%"),n<0&&(this.dom.style.transform="translateY( calc( 32px - 100% ) )")),super.show()}hide(){return this.opened&&(T=null),super.hide()}add(t,e=null){return t.addEventListener("click",this._onButtonClick),t.addEventListener("mouseover",this._onButtonMouseOver),super.add(t,e)}get opened(){return T===this}}class N extends _{constructor(t=null){super("circle",t)}}class B extends EventTarget{constructor(){super();const t=document.createElement("f-tips");this.dom=t,this.time=0,this.duration=3e3}message(t){return this.tip(t)}error(t){return this.tip(t,"error")}tip(t,e=""){const n=document.createElement("f-tip");return n.className=e,n.innerHTML=t,this.dom.prepend(n),this.time=Math.min(this.time+this.duration,this.duration),setTimeout((()=>{this.time-=this.duration,n.style.opacity=0,setTimeout((()=>n.remove()),250)}),this.time),this}}const V=t=>t.trim().toLowerCase().replace(/\s\s+/g," ");class P extends _{constructor(){super("search"),this.events.submit=[],this.events.filter=[];const t=document.createElement("input");t.placeholder="Type here";let e=!0,n=!0;t.addEventListener("focusout",(()=>{n=!0,this.setValue("")})),t.onkeydown=n=>{const i=n.keyCode;if(38===i){const t=this.filteredIndex;this.forceAutoComplete?this.filteredIndex=null!==t?(t+1)%(this.filtered.length||1):0:this.filteredIndex=null!==t?Math.min(t+1,this.filtered.length-1):0,n.preventDefault(),e=!1}else if(40===i){const t=this.filteredIndex;this.forceAutoComplete?(this.filteredIndex=t-1,null===this.filteredIndex&&(this.filteredIndex=this.filtered.length-1)):this.filteredIndex=null!==t?t-1:null,n.preventDefault(),e=!1}else 13===i?(this.value=this.currentFiltered?this.currentFiltered.button.getValue():t.value,this.submit(),n.preventDefault(),e=!1):e=!0},t.onkeyup=()=>{e&&(n&&(this.dispatchEvent(new Event("filter")),n=!1),this.filter(t.value))},this.filtered=[],this.currentFiltered=null,this.value="",this.forceAutoComplete=!1,this.dom.append(t),this.inputDOM=t,this.addEventListener("filter",(()=>{r(this.events.filter,this)})),this.addEventListener("submit",(()=>{r(this.events.submit,this)}))}submit(){return this.dispatchEvent(new Event("submit")),this.setValue("")}setValue(t){return this.inputDOM.value=t,this.filter(t),this}getValue(){return this.value}onFilter(t){return this.events.filter.push(t),this}onSubmit(t){return this.events.submit.push(t),this}getFilterByButton(t){for(const e of this.filtered)if(e.button===t)return e;return null}add(t){super.add(t);const e=()=>{const e=this.getFilterByButton(t);this.filteredIndex=this.filtered.indexOf(e),this.value=t.getValue(),this.submit()};return t.dom.addEventListener("mousedown",e),t.dom.addEventListener("touchstart",e),this.domButtons.get(t).remove(),this}set filteredIndex(t){if(this.currentFiltered){this.domButtons.get(this.currentFiltered.button).classList.remove("active"),this.currentFiltered=null}const e=this.filtered[t];if(e){this.domButtons.get(e.button).classList.add("active"),this.currentFiltered=e}this.updateFilter()}get filteredIndex(){return this.currentFiltered?this.filtered.indexOf(this.currentFiltered):null}filter(t){t=V(t);const e=[];for(const n of this.buttons){this.domButtons.get(n).remove();const i=V(n.getValue());if(t&&!0===i.includes(t)){const s=t.length/i.length;e.push({button:n,score:s})}}e.sort(((t,e)=>e.score-t.score)),this.filtered=e,this.filteredIndex=this.forceAutoComplete?0:null}updateFilter(){const t=Math.min(this.filteredIndex,this.filteredIndex-3);for(let e=0;e<this.filtered.length;e++){const n=this.filtered[e].button,i=this.domButtons.get(n);i.remove(),e>=t&&this.listDOM.append(i)}}}class R extends p{constructor(t=[],e=null){const n=document.createElement("select");super(n),n.onchange=()=>{this.dispatchEvent(new Event("change"))},n.onmousedown=n.ontouchstart=()=>{this.dispatchEvent(new Event("click"))},this.setOptions(t,e)}setOptions(t,e=null){const n=this.dom,i=n.value;let s=!1;this.options=t,n.innerHTML="";for(let e=0;e<t.length;e++){let o=t[e];"string"==typeof o&&(o={name:o,value:e});const r=document.createElement("option");r.innerText=o.name,r.value=o.value,!1===s&&i===o.value&&(s=!0),n.append(r)}return n.value=null!==e?e:s?i:"",this}getOptions(){return this._options}serialize(t){t.options=[...this.options],super.serialize(t)}deserialize(t){0===this.options.length&&this.setOptions(t.options),super.deserialize(t)}}class Y extends p{constructor(t=!1){const e=document.createElement("input");super(e),e.type="checkbox",e.className="toggle",e.checked=t,e.onclick=()=>this.dispatchEvent(new Event("click")),e.onchange=()=>this.dispatchEvent(new Event("change"))}setValue(t){return this.dom.checked=t,this.dispatchEvent(new Event("change")),this}getValue(){return this.dom.checked}}var F=Object.freeze({__proto__:null,Element:u,Input:p,Node:m,Canvas:E,Serializer:i,Styles:e,ObjectNode:w,PanelNode:z,Menu:_,ContextMenu:j,CircleMenu:N,Tips:B,Search:P,DraggableElement:f,LabelElement:D,TitleElement:g,ButtonInput:y,ColorInput:M,NumberInput:k,SelectInput:R,SliderInput:C,StringInput:L,TextInput:I,ToggleInput:Y});class X extends EventTarget{constructor(t=X.DEFAULT){super(),this.parseType=t,this.events={load:[]}}setParseType(t){return this.parseType=t,this}getParseType(){return this.parseType}onLoad(t){return this.events.load.push(t),this}async load(t,e=null){return await fetch(t).then((t=>t.json())).then((t=>(this.data=this.parse(t,e),r(this.events.load,this),this.data))).catch((t=>{console.error("Loader:",t)}))}parse(t,e=null){t=this._parseObjects(t,e);const n=this.parseType;if(n===X.DEFAULT){const e=new F[t.type];return e.getSerializable()&&e.deserialize(t),e}if(n===X.OBJECTS)return t}_parseObjects(t,e=null){t={...t};const n={};for(const i in t.objects){const s=t.objects[i];s.objects=n;const o=e&&e[s.type]?e[s.type]:F[s.type];o||console.error(`Class "${s.type}" not found!`),n[i]=new o}const i=new WeakMap,s=(e=null)=>{for(const s in t.objects){const o=n[s];!1!==i.has(o)||null!==e&&!0!==o[e]||(i.set(o,!0),o.getSerializable()&&o.deserialize(t.objects[s]))}};return s("isNode"),s("isElement"),s("isInput"),s(),t.objects=n,t}}X.DEFAULT="default",X.OBJECTS="objects",t.ButtonInput=y,t.Canvas=E,t.CircleMenu=N,t.ColorInput=M,t.ContextMenu=j,t.DraggableElement=f,t.Element=u,t.Input=p,t.LabelElement=D,t.Loader=X,t.Menu=_,t.Node=m,t.NumberInput=k,t.ObjectNode=w,t.PanelNode=z,t.REVISION="1",t.Search=P,t.SelectInput=R,t.Serializer=i,t.SliderInput=C,t.StringInput=L,t.Styles=e,t.TextInput=I,t.Tips=B,t.TitleElement=g,t.ToggleInput=Y,t.Utils=d,Object.defineProperty(t,"__esModule",{value:!0})}));
